import{u as Z,c as C,r as p,w as E,a as j,b as o,d as s,f as A,n as F,g as ee,e as b,l as te,j as y,v as se,h as r,F as h,i as _,t as n,m as H,k as V,A as k,o as a}from"./app-BG8bJDk_.js";import{_ as le}from"./Breadcrumbs-BJkTr2TQ.js";import{u as ae,_ as oe,a as re}from"./MainHeader-CSzL04-A.js";import{_ as ne}from"./MainSidebar-Gh5823Zl.js";import{_ as ie}from"./SystemNoticeStack-D6BD3byq.js";const de={class:"relative min-h-screen overflow-hidden bg-[#f7f1e6] text-slate-900"},ue={class:"relative mx-auto flex max-w-[1360px] flex-col gap-8 px-6 py-8"},ce={class:"rounded-3xl border border-slate-200/80 bg-white/90 p-6 shadow-sm page-content-wrapper"},pe={class:"mt-6 grid gap-6 lg:grid-cols-2"},be={class:"rounded-2xl border border-slate-200 bg-white p-4"},ve=["value"],me={key:0,class:"text-xs text-rose-700"},xe=["disabled"],ge={class:"rounded-2xl border border-slate-200 bg-white p-4"},fe={class:"mt-4 space-y-2 text-sm text-slate-700"},ye={key:0,class:"text-sm text-slate-500"},he={key:1,class:"space-y-2"},_e=["onClick"],ke={class:"relative mt-4"},we={class:"flex flex-col gap-1 text-xs uppercase tracking-[0.15em] text-slate-500"},Se={key:0,class:"text-xs text-rose-700"},Le={key:1,class:"absolute left-0 right-0 z-10 mt-2 w-full rounded-2xl border border-slate-200 bg-white text-sm text-slate-700"},$e=["onClick"],Ce={class:"font-semibold"},Ae={key:0,class:"text-xs text-slate-500"},Ve={key:0,class:"mt-2 text-xs text-rose-700"},Be=["disabled"],Ne={class:"mt-6 rounded-2xl border border-slate-200 bg-white p-4"},Ue={class:"mt-4 space-y-2 text-sm text-slate-700"},je={key:0,class:"text-sm text-slate-500"},Fe={key:1,class:"space-y-2"},Te=["onClick"],Me={class:"relative mt-4"},Oe={class:"flex flex-col gap-1 text-xs uppercase tracking-[0.15em] text-slate-500"},De={key:0,class:"absolute left-0 right-0 z-10 mt-2 w-full rounded-2xl border border-slate-200 bg-white text-sm text-slate-700"},qe=["onClick"],ze={class:"font-semibold"},Ee={key:0,class:"text-xs text-slate-500"},He={key:0,class:"mt-2 text-xs text-rose-700"},Ie=["disabled"],Ke={__name:"AccountMessagesSettings",props:{appName:{type:String,default:"Laravel"},user:{type:Object,default:null},privacySetting:{type:Object,default:()=>({})},privacyOptions:{type:Array,default:()=>[]},allowList:{type:Array,default:()=>[]},blockList:{type:Array,default:()=>[]},navigation:{type:Object,default:()=>({title:"Аккаунт",data:[]})},activeHref:{type:String,default:""},breadcrumbs:{type:Array,default:()=>[]}},setup(u){const v=u,I=Z(),R=C(()=>I.props?.flash?.notice??""),T=C(()=>v.navigation?.data??v.navigation?.items??[]),M=C(()=>(T.value?.length??0)>0),B=p([...v.allowList]),N=p([...v.blockList]);E(()=>v.allowList,l=>{B.value=[...l??[]]}),E(()=>v.blockList,l=>{N.value=[...l??[]]});const{unreadCount:Q}=ae({}),O=l=>l.key==="messages"?{...l,badge:Q.value}:l,D=C(()=>T.value.map(l=>Array.isArray(l?.items)?{...l,items:l.items.map(O)}:O(l))),g=j({mode:v.privacySetting?.mode??"all"}),P=()=>{g.patch("/account/settings/messages",{preserveScroll:!0,onSuccess:()=>k.reload({only:["privacySetting"]})})},i=j({user_id:""}),d=j({user_id:""}),m=p(!1),f=p(""),c=p([]),w=p(""),S=p(""),L=p("allow");let U=null,$=0;const q=(l,t)=>{if(L.value=t,U&&clearTimeout(U),c.value=[],f.value="",!l||l.trim().length<2){m.value=!1;return}U=setTimeout(()=>{G(l.trim())},250)},G=async l=>{const t=++$;m.value=!0;try{const e=await fetch(`/integrations/user-suggest?query=${encodeURIComponent(l)}`);if(!e.ok)throw new Error("failed");const x=await e.json();if(t!==$)return;c.value=x?.suggestions??[],f.value=c.value.length?"":"Варианты не найдены."}catch{if(t!==$)return;c.value=[],f.value="Не удалось получить подсказки."}finally{if(t!==$)return;m.value=!1}},z=l=>{L.value==="block"?(d.user_id=l.id,S.value=l.login||""):(i.user_id=l.id,w.value=l.login||""),c.value=[],f.value=""},J=()=>{i.post("/account/settings/messages/allow-list",{preserveScroll:!0,onSuccess:()=>{i.reset("user_id"),w.value="",k.reload({only:["allowList","blockList"]})}})},K=()=>{d.post("/account/settings/messages/block-list",{preserveScroll:!0,onSuccess:()=>{d.reset("user_id"),S.value="",k.reload({only:["allowList","blockList"]})}})},W=l=>{l&&i.delete(`/account/settings/messages/allow-list/${l}`,{preserveScroll:!0,onSuccess:()=>k.reload({only:["allowList","blockList"]})})},X=l=>{l&&d.delete(`/account/settings/messages/block-list/${l}`,{preserveScroll:!0,onSuccess:()=>k.reload({only:["allowList","blockList"]})})};return(l,t)=>(a(),o("div",de,[t[14]||(t[14]=s("div",{class:"pointer-events-none absolute -left-28 top-12 h-72 w-72 rounded-full bg-emerald-200/70 blur-3xl"},null,-1)),t[15]||(t[15]=s("div",{class:"pointer-events-none absolute -right-24 -top-24 h-80 w-80 rounded-full bg-amber-200/70 blur-3xl"},null,-1)),A(ie,{success:R.value},null,8,["success"]),s("div",ue,[A(oe,{"app-name":u.appName,"is-authenticated":!!l.$page.props.auth?.user,"login-label":l.$page.props.auth?.user?.login,"sidebar-title":u.navigation.title,"sidebar-items":D.value,"sidebar-active-href":u.activeHref},null,8,["app-name","is-authenticated","login-label","sidebar-title","sidebar-items","sidebar-active-href"]),s("main",{class:F(["grid gap-6",{"lg:grid-cols-[240px_1fr]":M.value}])},[M.value?(a(),ee(ne,{key:0,title:u.navigation.title,data:D.value,"active-href":u.activeHref},null,8,["title","data","active-href"])):b("",!0),s("div",ce,[A(le,{items:u.breadcrumbs},null,8,["items"]),t[13]||(t[13]=s("h1",{class:"text-3xl font-semibold text-slate-900"},"Настройки сообщений",-1)),s("div",pe,[s("div",be,[t[8]||(t[8]=s("p",{class:"text-xs font-semibold uppercase tracking-[0.15em] text-slate-500"},"Приватность",-1)),s("form",{class:"mt-4 space-y-3",onSubmit:te(P,["prevent"])},[y(s("select",{"onUpdate:modelValue":t[0]||(t[0]=e=>r(g).mode=e),class:"w-full rounded-2xl border border-slate-200 bg-white px-4 py-3 text-sm text-slate-700"},[(a(!0),o(h,null,_(u.privacyOptions,e=>(a(),o("option",{key:e.value,value:e.value},n(e.label),9,ve))),128))],512),[[se,r(g).mode]]),t[7]||(t[7]=s("p",{class:"text-xs text-slate-500"}," Группы (коллеги/друзья) будут доступны позже. ",-1)),r(g).errors.mode?(a(),o("div",me,n(r(g).errors.mode),1)):b("",!0),s("button",{class:"rounded-full border border-slate-900 bg-slate-900 px-4 py-2 text-sm font-semibold text-white transition hover:-translate-y-0.5 hover:bg-slate-800",type:"submit",disabled:r(g).processing}," Сохранить ",8,xe)],32)]),s("div",ge,[t[10]||(t[10]=s("p",{class:"text-xs font-semibold uppercase tracking-[0.15em] text-slate-500"},"Белый список",-1)),s("div",fe,[B.value.length?(a(),o("div",he,[(a(!0),o(h,null,_(B.value,e=>(a(),o("div",{key:e.id,class:"flex items-center justify-between rounded-2xl border border-slate-200 bg-slate-50 px-3 py-2"},[s("span",null,n(e.user?.login||"—"),1),s("button",{class:"text-xs font-semibold text-rose-600",type:"button",onClick:x=>W(e.user?.id)}," Удалить ",8,_e)]))),128))])):(a(),o("div",ye,"Список пуст."))]),s("div",ke,[s("label",we,[t[9]||(t[9]=H(" Добавить пользователя ",-1)),y(s("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>w.value=e),class:F(["rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm text-slate-700",{"is-loading":m.value}]),type:"text",placeholder:"Начните вводить логин",onInput:t[2]||(t[2]=e=>q(e.target.value,"allow"))},null,34),[[V,w.value]])]),y(s("input",{"onUpdate:modelValue":t[3]||(t[3]=e=>r(i).user_id=e),type:"hidden"},null,512),[[V,r(i).user_id]]),f.value?(a(),o("div",Se,n(f.value),1)):!m.value&&c.value.length&&L.value==="allow"?(a(),o("div",Le,[(a(!0),o(h,null,_(c.value,(e,x)=>(a(),o("button",{key:`${e.id}-${x}`,class:"flex w-full items-start gap-2 border-b border-slate-100 px-3 py-2 text-left last:border-b-0 hover:bg-slate-50",type:"button",onClick:Y=>z(e)},[s("span",Ce,n(e.login),1),e.email?(a(),o("span",Ae,n(e.email),1)):b("",!0)],8,$e))),128))])):b("",!0)]),r(i).errors.user_id?(a(),o("div",Ve,n(r(i).errors.user_id),1)):b("",!0),s("button",{class:"mt-3 rounded-full border border-slate-900 bg-slate-900 px-4 py-2 text-sm font-semibold text-white transition hover:-translate-y-0.5 hover:bg-slate-800",type:"button",disabled:r(i).processing||!r(i).user_id,onClick:J}," Добавить ",8,Be)])]),s("div",Ne,[t[12]||(t[12]=s("p",{class:"text-xs font-semibold uppercase tracking-[0.15em] text-slate-500"},"Черный список",-1)),s("div",Ue,[N.value.length?(a(),o("div",Fe,[(a(!0),o(h,null,_(N.value,e=>(a(),o("div",{key:e.id,class:"flex items-center justify-between rounded-2xl border border-slate-200 bg-slate-50 px-3 py-2"},[s("span",null,n(e.user?.login||"—"),1),s("button",{class:"text-xs font-semibold text-rose-600",type:"button",onClick:x=>X(e.user?.id)}," Удалить ",8,Te)]))),128))])):(a(),o("div",je,"Список пуст."))]),s("div",Me,[s("label",Oe,[t[11]||(t[11]=H(" Добавить пользователя ",-1)),y(s("input",{"onUpdate:modelValue":t[4]||(t[4]=e=>S.value=e),class:F(["rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm text-slate-700",{"is-loading":m.value}]),type:"text",placeholder:"Начните вводить логин",onInput:t[5]||(t[5]=e=>q(e.target.value,"block"))},null,34),[[V,S.value]])]),y(s("input",{"onUpdate:modelValue":t[6]||(t[6]=e=>r(d).user_id=e),type:"hidden"},null,512),[[V,r(d).user_id]]),!m.value&&c.value.length&&L.value==="block"?(a(),o("div",De,[(a(!0),o(h,null,_(c.value,(e,x)=>(a(),o("button",{key:`${e.id}-${x}`,class:"flex w-full items-start gap-2 border-b border-slate-100 px-3 py-2 text-left last:border-b-0 hover:bg-slate-50",type:"button",onClick:Y=>z(e)},[s("span",ze,n(e.login),1),e.email?(a(),o("span",Ee,n(e.email),1)):b("",!0)],8,qe))),128))])):b("",!0)]),r(d).errors.user_id?(a(),o("div",He,n(r(d).errors.user_id),1)):b("",!0),s("button",{class:"mt-3 rounded-full border border-rose-600 bg-rose-600 px-4 py-2 text-sm font-semibold text-white transition hover:-translate-y-0.5 hover:bg-rose-700",type:"button",disabled:r(d).processing||!r(d).user_id,onClick:K}," Добавить ",8,Ie)])])],2),A(re,{"app-name":u.appName},null,8,["app-name"])])]))}};export{Ke as default};
