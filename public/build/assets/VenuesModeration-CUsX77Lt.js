import{c as D,a as _,r as b,u as ne,w as de,b as n,d as e,f as S,e as u,n as y,g as G,m as J,j as $,v as K,h as o,F as V,i as F,C as ie,l as L,k as Q,t as r,A as pe,o as a,z as ue}from"./app-BG8bJDk_.js";import{_ as ce}from"./Breadcrumbs-BJkTr2TQ.js";import{_ as xe,a as be}from"./MainHeader-CSzL04-A.js";import{_ as ve}from"./MainSidebar-Gh5823Zl.js";import{_ as me}from"./SystemNoticeStack-D6BD3byq.js";const fe={class:"relative min-h-screen overflow-hidden bg-[#f7f1e6] text-slate-900"},ge={class:"relative mx-auto flex max-w-[1360px] flex-col gap-8 px-6 py-8"},ye={class:"rounded-3xl border border-slate-200/80 bg-white/90 p-6 shadow-sm page-content-wrapper"},he={class:"mt-6 rounded-2xl border border-slate-200 bg-slate-50 p-4"},_e={class:"flex flex-wrap items-center gap-4"},we={class:"flex flex-col gap-1 text-xs uppercase tracking-[0.15em] text-slate-500"},ke=["value"],je={class:"flex flex-col gap-1 text-xs uppercase tracking-[0.15em] text-slate-500"},Ce=["value"],Se={key:0,class:"mt-6 w-full overflow-x-auto rounded-2xl border border-slate-200"},$e={class:"min-w-max"},Ve=["onClick"],Fe=["title"],Ne={class:"flex flex-wrap items-center gap-2"},Oe=["disabled","onClick"],Ee=["disabled","onClick"],Te=["disabled","onClick"],Be=["disabled","onClick"],Ae={class:"font-semibold text-slate-800"},Me=["title"],ze={key:1,class:"mt-6 rounded-2xl border border-dashed border-slate-200 bg-slate-50 px-4 py-6 text-sm text-slate-500"},De={key:2,class:"mt-6 flex flex-wrap items-center gap-2 text-sm"},Le={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-slate-900/40 px-4"},Re={class:"w-full max-w-lg rounded-3xl border border-slate-200 bg-white shadow-xl"},Ue={class:"popup-body max-h-[500px] overflow-y-auto px-6 pt-4"},He={key:0,class:"mt-2 text-xs text-rose-700"},Pe={class:"popup-footer flex flex-wrap justify-end gap-3 border-t border-slate-200/80 px-6 py-4"},Ge=["disabled"],Je=["disabled"],Ke={key:1,class:"fixed inset-0 z-50 flex items-center justify-center bg-slate-900/40 px-4"},Qe={class:"w-full max-w-lg rounded-3xl border border-slate-200 bg-white shadow-xl"},We={class:"popup-body max-h-[500px] overflow-y-auto px-6 pt-4"},Xe={key:0,class:"mt-2 text-xs text-rose-700"},Ye={class:"popup-footer flex flex-wrap justify-end gap-3 border-t border-slate-200/80 px-6 py-4"},Ze=["disabled"],qe=["disabled"],Ie={key:2,class:"fixed inset-0 z-50 flex items-center justify-center bg-slate-900/40 px-4"},et={class:"w-full max-w-lg rounded-3xl border border-slate-200 bg-white shadow-xl"},tt={class:"popup-body max-h-[500px] overflow-y-auto px-6 pt-4"},st={class:"rounded-2xl border border-slate-200 bg-slate-50 px-4 py-3 text-sm text-slate-700"},ot={class:"flex flex-wrap items-center justify-between gap-2"},rt={class:"font-semibold"},at={class:"mt-3 grid gap-2 text-sm"},lt={class:"flex items-center justify-between"},nt={class:"flex items-center justify-between"},dt={class:"flex items-center justify-between"},it={class:"flex items-center justify-between"},pt={key:3,class:"fixed inset-0 z-50 flex items-center justify-center bg-slate-900/40 px-4"},ut={class:"w-full max-w-lg rounded-3xl border border-slate-200 bg-white shadow-xl"},ct={class:"popup-body max-h-[500px] overflow-y-auto px-6 pt-4"},xt={class:"mt-4 rounded-2xl border border-slate-200 bg-slate-50 px-4 py-3 text-sm text-slate-700"},bt={class:"flex flex-wrap items-center justify-between gap-2"},vt={class:"font-semibold"},mt={class:"mt-3 grid gap-2 text-sm"},ft={class:"flex items-center justify-between"},gt={class:"flex items-center justify-between"},yt={class:"flex items-center justify-between"},ht={class:"popup-footer flex flex-wrap justify-end gap-3 border-t border-slate-200/80 px-6 py-4"},_t=["disabled"],wt=["disabled"],Vt={__name:"VenuesModeration",props:{appName:{type:String,default:"Laravel"},navigation:{type:Object,default:()=>({title:"Разделы",data:[]})},activeHref:{type:String,default:""},filters:{type:Object,default:()=>({status:"",sort:"submitted_at_desc"})},statusOptions:{type:Array,default:()=>[]},sortOptions:{type:Array,default:()=>[]},requests:{type:Object,default:()=>({data:[],links:[]})},breadcrumbs:{type:Array,default:()=>[]}},setup(c){const w=c,R=D(()=>w.navigation?.data??[]),U=D(()=>(R.value?.length??0)>0),v=_({status:w.filters?.status??"",sort:w.filters?.sort??"submitted_at_desc"}),x=b(""),d=b(""),N=b(!1),k=b(null),i=_({reason:""}),h=_({}),p=_({reason:""}),H=_({}),O=b(!1),m=b(null),E=b(!1),j=b(null),T=b(!1),g=b(null),f=ne(),W={pending:"На модерации",approved:"Подтверждено",rejected:"Отклонено"},B=l=>{if(!l)return"—";const t=new Date(l);return Number.isNaN(t.getTime())?l:t.toLocaleString("ru-RU")},X=()=>{pe.get("/admin/venues-moderation",{status:v.status,sort:v.sort},{preserveState:!0,replace:!0})};de(()=>[v.status,v.sort],()=>{X()});const Y=l=>{x.value="",d.value="",h.post(`/admin/venues-moderation/${l.id}/approve`,{preserveScroll:!0,onSuccess:()=>{x.value="Площадка подтверждена."},onError:t=>{d.value=t.moderation||"Не удалось подтвердить заявку."},onFinish:()=>{f.props?.errors?.moderation&&(d.value=f.props.errors.moderation)}})},Z=l=>{x.value="",d.value="",m.value=l,O.value=!0},A=()=>{O.value=!1,m.value=null},q=()=>{m.value&&(Y(m.value),A())},I=l=>{x.value="",d.value="",p.post(`/admin/venues-moderation/${l.id}/block`,{preserveScroll:!0,onSuccess:()=>{x.value="Площадка заблокирована."},onError:t=>{d.value=t.moderation||p.errors.reason||"Не удалось заблокировать площадку."},onFinish:()=>{f.props?.errors?.moderation&&(d.value=f.props.errors.moderation)}})},ee=l=>{x.value="",d.value="",H.post(`/admin/venues-moderation/${l.id}/unblock`,{preserveScroll:!0,onSuccess:()=>{x.value="Площадка разблокирована."},onError:t=>{d.value=t.moderation||"Не удалось разблокировать площадку."},onFinish:()=>{f.props?.errors?.moderation&&(d.value=f.props.errors.moderation)}})},te=l=>{x.value="",d.value="",j.value=l,p.reason="",p.clearErrors(),E.value=!0},M=()=>{E.value=!1,j.value=null,p.reset("reason"),p.clearErrors()},se=()=>{j.value&&(I(j.value),M())},oe=l=>{x.value="",d.value="",k.value=l,i.reason="",i.clearErrors(),N.value=!0},z=()=>{N.value=!1,k.value=null,i.reset("reason"),i.clearErrors()},re=l=>{g.value=l,T.value=!0},P=()=>{T.value=!1,g.value=null},ae=()=>{k.value&&i.post(`/admin/venues-moderation/${k.value.id}/reject`,{preserveScroll:!0,onSuccess:()=>{x.value="Заявка отклонена.",z()},onError:l=>{d.value=l.moderation||i.errors.reason||"Не удалось отклонить заявку."},onFinish:()=>{f.props?.errors?.moderation&&(d.value=f.props.errors.moderation)}})},le=D(()=>(w.requests?.data?.length??0)>0);return(l,t)=>(a(),n("div",fe,[t[24]||(t[24]=e("div",{class:"pointer-events-none absolute -left-28 top-12 h-72 w-72 rounded-full bg-emerald-200/70 blur-3xl"},null,-1)),t[25]||(t[25]=e("div",{class:"pointer-events-none absolute -right-24 -top-24 h-80 w-80 rounded-full bg-amber-200/70 blur-3xl"},null,-1)),S(me,{success:x.value,error:d.value},null,8,["success","error"]),e("div",ge,[S(xe,{"app-name":c.appName,"is-authenticated":!!l.$page.props.auth?.user,"login-label":l.$page.props.auth?.user?.login},null,8,["app-name","is-authenticated","login-label"]),e("main",{class:y(["grid gap-6",{"lg:grid-cols-[240px_1fr]":U.value}])},[U.value?(a(),G(ve,{key:0,title:c.navigation.title,data:R.value,"active-href":c.activeHref},null,8,["title","data","active-href"])):u("",!0),e("div",ye,[S(ce,{items:c.breadcrumbs},null,8,["items"]),t[7]||(t[7]=e("h1",{class:"text-3xl font-semibold text-slate-900"},"Модерация площадок",-1)),e("div",he,[e("div",_e,[e("label",we,[t[4]||(t[4]=J(" Статус ",-1)),$(e("select",{"onUpdate:modelValue":t[0]||(t[0]=s=>o(v).status=s),class:"rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm text-slate-700"},[(a(!0),n(V,null,F(c.statusOptions,s=>(a(),n("option",{key:s.value,value:s.value},r(s.label),9,ke))),128))],512),[[K,o(v).status]])]),e("label",je,[t[5]||(t[5]=J(" Сортировка ",-1)),$(e("select",{"onUpdate:modelValue":t[1]||(t[1]=s=>o(v).sort=s),class:"rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm text-slate-700"},[(a(!0),n(V,null,F(c.sortOptions,s=>(a(),n("option",{key:s.value,value:s.value},r(s.label),9,Ce))),128))],512),[[K,o(v).sort]])])])]),le.value?(a(),n("div",Se,[e("div",$e,[t[6]||(t[6]=ie('<div class="grid grid-cols-[160px_140px_200px_80px_160px_220px_140px_160px_160px_160px_160px] gap-4 bg-slate-50 px-4 py-3 text-xs uppercase tracking-[0.15em] text-slate-500 whitespace-nowrap"><span>Площадка</span><span>Статус</span><span>Действия</span><span>ID</span><span>Тип</span><span>Адрес</span><span>Создатель</span><span>Создана</span><span>Отправлено</span><span>Решение</span><span>Кто решил</span></div>',1)),(a(!0),n(V,null,F(c.requests.data,s=>(a(),n("div",{key:s.id,class:"grid grid-cols-[160px_140px_200px_80px_160px_220px_140px_160px_160px_160px_160px] gap-4 border-t border-slate-100 px-4 py-4 text-sm text-slate-700 whitespace-nowrap"},[e("div",null,[e("button",{class:"text-left text-sm font-medium text-slate-800 transition hover:text-slate-700",type:"button",onClick:C=>re(s)},r(s.venue?.name||"—"),9,Ve)]),e("div",null,[e("span",{class:y(["rounded-full border border-slate-200 bg-slate-50 px-2 py-0.5 text-xs font-semibold text-slate-600",{"border-amber-200 bg-amber-50 text-amber-800":s.status==="pending","border-emerald-200 bg-emerald-50 text-emerald-700":s.status==="approved","border-rose-200 bg-rose-50 text-rose-700":s.status==="rejected"}]),title:s.submitted_at?B(s.submitted_at):void 0},r(W[s.status]||"—"),11,Fe)]),e("div",Ne,[s.status==="pending"?(a(),n("button",{key:0,class:"rounded-full border border-emerald-300 bg-emerald-50 px-3 py-1 text-xs font-semibold text-emerald-800 transition hover:-translate-y-0.5 hover:border-emerald-400",type:"button",disabled:o(h).processing,onClick:C=>Z(s)}," Подтвердить ",8,Oe)):u("",!0),s.status==="pending"?(a(),n("button",{key:1,class:"rounded-full border border-rose-300 bg-rose-50 px-3 py-1 text-xs font-semibold text-rose-700 transition hover:-translate-y-0.5 hover:border-rose-400",type:"button",disabled:o(i).processing,onClick:C=>oe(s)}," Отклонить ",8,Ee)):u("",!0),s.status==="approved"&&s.venue?.status==="confirmed"?(a(),n("button",{key:2,class:"rounded-full border border-rose-300 bg-rose-50 px-3 py-1 text-xs font-semibold text-rose-700 transition hover:-translate-y-0.5 hover:border-rose-400",type:"button",disabled:o(p).processing,onClick:C=>te(s)}," Заблокировать ",8,Te)):u("",!0),s.status==="approved"&&s.venue?.status==="blocked"?(a(),n("button",{key:3,class:"rounded-full border border-emerald-300 bg-emerald-50 px-3 py-1 text-xs font-semibold text-emerald-800 transition hover:-translate-y-0.5 hover:border-emerald-400",type:"button",disabled:o(H).processing,onClick:C=>ee(s)}," Разблокировать ",8,Be)):u("",!0)]),e("div",Ae,"#"+r(s.id),1),e("div",null,r(s.type?.name||"—"),1),e("div",{class:"truncate",title:s.venue?.address||""},r(s.venue?.address||"—"),9,Me),e("div",null,r(s.creator?.login||"—"),1),e("div",null,r(s.venue?.created_at||"—"),1),e("div",null,r(s.submitted_at?B(s.submitted_at):"—"),1),e("div",null,r(s.reviewed_at?B(s.reviewed_at):"—"),1),e("div",null,r(s.reviewer?.login||"—"),1)]))),128))])])):(a(),n("div",ze," Заявки не найдены. ")),c.requests.links?.length?(a(),n("div",De,[(a(!0),n(V,null,F(c.requests.links,s=>(a(),G(o(ue),{key:s.label,class:y(["rounded-full border border-slate-200 px-3 py-1 text-slate-600 transition hover:-translate-y-0.5 hover:border-slate-300",{"bg-slate-900 text-white":s.active,"pointer-events-none opacity-50":!s.url}]),href:s.url||"",innerHTML:s.label},null,8,["class","href","innerHTML"]))),128))])):u("",!0)])],2),S(be,{"app-name":c.appName},null,8,["app-name"])]),N.value?(a(),n("div",Le,[e("div",Re,[e("form",{class:y({loading:o(i).processing}),onSubmit:L(ae,["prevent"])},[e("div",{class:"popup-header flex items-center justify-between border-b border-slate-200/80 px-6 py-4"},[t[8]||(t[8]=e("h2",{class:"text-lg font-semibold text-slate-900"},"Отклонить заявку",-1)),e("button",{class:"rounded-full border border-slate-200 px-2.5 py-1 text-sm text-slate-500 transition hover:border-slate-300 hover:text-slate-700",type:"button","aria-label":"Закрыть",onClick:z}," x ")]),e("div",Ue,[t[9]||(t[9]=e("p",{class:"text-sm text-slate-600"}," Вы можете указать причину отклонения. Она будет показана владельцу площадки. ",-1)),$(e("textarea",{"onUpdate:modelValue":t[2]||(t[2]=s=>o(i).reason=s),class:"mt-4 min-h-[120px] w-full rounded-2xl border border-slate-200 bg-slate-50 px-4 py-3 text-sm text-slate-700 focus:border-slate-400 focus:outline-none",placeholder:"Причина отклонения (необязательно)"},null,512),[[Q,o(i).reason]]),o(i).errors.reason?(a(),n("div",He,r(o(i).errors.reason),1)):u("",!0)]),e("div",Pe,[e("button",{class:"rounded-full border border-slate-200 px-4 py-2 text-sm text-slate-600 transition hover:-translate-y-0.5 hover:border-slate-300",type:"button",disabled:o(i).processing,onClick:z}," Закрыть ",8,Ge),e("button",{class:"rounded-full border border-rose-600 bg-rose-600 px-4 py-2 text-sm font-semibold text-white transition hover:-translate-y-0.5 hover:bg-rose-700",type:"submit",disabled:o(i).processing}," Отклонить ",8,Je)])],34)])])):u("",!0),E.value?(a(),n("div",Ke,[e("div",Qe,[e("form",{class:y({loading:o(p).processing}),onSubmit:L(se,["prevent"])},[e("div",{class:"popup-header flex items-center justify-between border-b border-slate-200/80 px-6 py-4"},[t[10]||(t[10]=e("h2",{class:"text-lg font-semibold text-slate-900"},"Заблокировать площадку",-1)),e("button",{class:"rounded-full border border-slate-200 px-2.5 py-1 text-sm text-slate-500 transition hover:border-slate-300 hover:text-slate-700",type:"button","aria-label":"Закрыть",onClick:M}," x ")]),e("div",We,[t[11]||(t[11]=e("p",{class:"text-sm text-slate-600"}," Укажите причину блокировки (необязательно). Она может быть использована в коммуникации с владельцем. ",-1)),$(e("textarea",{"onUpdate:modelValue":t[3]||(t[3]=s=>o(p).reason=s),class:"mt-4 min-h-[120px] w-full rounded-2xl border border-slate-200 bg-slate-50 px-4 py-3 text-sm text-slate-700 focus:border-slate-400 focus:outline-none",placeholder:"Причина блокировки (необязательно)"},null,512),[[Q,o(p).reason]]),o(p).errors.reason?(a(),n("div",Xe,r(o(p).errors.reason),1)):u("",!0)]),e("div",Ye,[e("button",{class:"rounded-full border border-slate-200 px-4 py-2 text-sm text-slate-600 transition hover:-translate-y-0.5 hover:border-slate-300",type:"button",disabled:o(p).processing,onClick:M}," Закрыть ",8,Ze),e("button",{class:"rounded-full border border-rose-600 bg-rose-600 px-4 py-2 text-sm font-semibold text-white transition hover:-translate-y-0.5 hover:bg-rose-700",type:"submit",disabled:o(p).processing}," Заблокировать ",8,qe)])],34)])])):u("",!0),T.value?(a(),n("div",Ie,[e("div",et,[e("div",{class:"popup-header flex items-center justify-between border-b border-slate-200/80 px-6 py-4"},[t[12]||(t[12]=e("h2",{class:"text-lg font-semibold text-slate-900"},"Данные площадки",-1)),e("button",{class:"rounded-full border border-slate-200 px-2.5 py-1 text-sm text-slate-500 transition hover:border-slate-300 hover:text-slate-700",type:"button","aria-label":"Закрыть",onClick:P}," x ")]),e("div",tt,[e("div",st,[e("div",ot,[t[13]||(t[13]=e("span",{class:"text-xs uppercase tracking-[0.15em] text-slate-500"},"Площадка",-1)),e("span",rt,r(g.value?.venue?.name||"—"),1)]),e("div",at,[e("div",lt,[t[14]||(t[14]=e("span",{class:"text-xs uppercase tracking-[0.15em] text-slate-500"},"Тип",-1)),e("span",null,r(g.value?.type?.name||"—"),1)]),e("div",nt,[t[15]||(t[15]=e("span",{class:"text-xs uppercase tracking-[0.15em] text-slate-500"},"Адрес",-1)),e("span",null,r(g.value?.venue?.address||"—"),1)]),e("div",dt,[t[16]||(t[16]=e("span",{class:"text-xs uppercase tracking-[0.15em] text-slate-500"},"Создатель",-1)),e("span",null,r(g.value?.creator?.login||"—"),1)]),e("div",it,[t[17]||(t[17]=e("span",{class:"text-xs uppercase tracking-[0.15em] text-slate-500"},"Создана",-1)),e("span",null,r(g.value?.venue?.created_at||"—"),1)])])])]),e("div",{class:"popup-footer flex flex-wrap justify-end gap-3 border-t border-slate-200/80 px-6 py-4"},[e("button",{class:"rounded-full border border-slate-200 px-4 py-2 text-sm text-slate-600 transition hover:-translate-y-0.5 hover:border-slate-300",type:"button",onClick:P}," Закрыть ")])])])):u("",!0),O.value?(a(),n("div",pt,[e("div",ut,[e("form",{class:y({loading:o(h).processing}),onSubmit:L(q,["prevent"])},[e("div",{class:"popup-header flex items-center justify-between border-b border-slate-200/80 px-6 py-4"},[t[18]||(t[18]=e("h2",{class:"text-lg font-semibold text-slate-900"},"Подтвердить площадку",-1)),e("button",{class:"rounded-full border border-slate-200 px-2.5 py-1 text-sm text-slate-500 transition hover:border-slate-300 hover:text-slate-700",type:"button","aria-label":"Закрыть",onClick:A}," x ")]),e("div",ct,[t[23]||(t[23]=e("p",{class:"text-sm text-slate-600"},' Площадка будет подтверждена, а заявка переведена в статус "Подтверждено". ',-1)),e("div",xt,[e("div",bt,[t[19]||(t[19]=e("span",{class:"text-xs uppercase tracking-[0.15em] text-slate-500"},"Площадка",-1)),e("span",vt,r(m.value?.venue?.name||"—"),1)]),e("div",mt,[e("div",ft,[t[20]||(t[20]=e("span",{class:"text-xs uppercase tracking-[0.15em] text-slate-500"},"Тип",-1)),e("span",null,r(m.value?.type?.name||"—"),1)]),e("div",gt,[t[21]||(t[21]=e("span",{class:"text-xs uppercase tracking-[0.15em] text-slate-500"},"Адрес",-1)),e("span",null,r(m.value?.venue?.address||"—"),1)]),e("div",yt,[t[22]||(t[22]=e("span",{class:"text-xs uppercase tracking-[0.15em] text-slate-500"},"Создатель",-1)),e("span",null,r(m.value?.creator?.login||"—"),1)])])])]),e("div",ht,[e("button",{class:"rounded-full border border-slate-200 px-4 py-2 text-sm text-slate-600 transition hover:-translate-y-0.5 hover:border-slate-300",type:"button",disabled:o(h).processing,onClick:A}," Закрыть ",8,_t),e("button",{class:"rounded-full border border-emerald-600 bg-emerald-600 px-4 py-2 text-sm font-semibold text-white transition hover:-translate-y-0.5 hover:bg-emerald-700",type:"submit",disabled:o(h).processing}," Подтвердить ",8,wt)])],34)])])):u("",!0)]))}};export{Vt as default};
