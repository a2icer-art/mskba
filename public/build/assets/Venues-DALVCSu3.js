import{u as Ce,c as u,r as p,w as V,a as Se,b as o,d as s,f as R,e as x,n as N,g as re,t as i,m as f,j as v,v as O,F as k,i as w,k as h,B as oe,h as n,l as ne,o as r,y as Ve,z as $e}from"./app-BG8bJDk_.js";import{_ as Ae}from"./AuthModal-C85lGBWW.js";import{_ as Ue}from"./Breadcrumbs-BJkTr2TQ.js";import{_ as Te,a as Be}from"./MainHeader-CSzL04-A.js";import{_ as Me}from"./MainSidebar-Gh5823Zl.js";const je={class:"relative min-h-screen overflow-hidden bg-[#f7f1e6] text-slate-900"},Le={class:"relative mx-auto flex max-w-[1360px] flex-col gap-8 px-6 py-8"},Fe={class:"rounded-3xl border border-slate-200/80 bg-white/90 p-6 shadow-sm page-content-wrapper"},Ne={class:"flex flex-wrap items-center justify-between gap-4"},Oe={class:"mt-6 flex flex-wrap items-end gap-3 rounded-2xl border border-slate-200 bg-slate-50 p-4"},qe={class:"flex flex-col gap-1 text-xs uppercase tracking-[0.15em] text-slate-500"},Ee=["value"],ze={class:"flex flex-col gap-1 text-xs uppercase tracking-[0.15em] text-slate-500"},De=["value"],Ie={class:"flex flex-col gap-1 text-xs uppercase tracking-[0.15em] text-slate-500"},Pe={class:"flex flex-col gap-1 text-xs uppercase tracking-[0.15em] text-slate-500"},Re=["value"],Ze={class:"flex flex-col gap-1 text-xs uppercase tracking-[0.15em] text-slate-500"},Qe={class:"flex items-center gap-2 text-sm text-slate-600"},Ge={class:"flex items-center gap-2 text-sm text-slate-600"},He=["disabled"],Je={key:0,class:"mt-6 grid gap-4"},Ke={key:0,class:"text-sm font-semibold uppercase tracking-[0.2em] text-slate-500"},We={class:"flex flex-wrap items-start justify-between gap-4"},Xe={class:"text-lg font-semibold text-slate-900"},Ye={key:1},et={class:"mt-1 text-sm text-slate-600"},tt={key:0,class:"mt-2 text-sm text-slate-600"},st={key:1,class:"mt-1 text-xs text-slate-500"},at={class:"mt-3 flex flex-wrap items-center gap-2 text-xs font-semibold uppercase tracking-[0.15em]"},lt={key:1,class:"mt-6 rounded-2xl border border-dashed border-slate-200 bg-white p-6 text-sm text-slate-600"},rt={class:"mt-6 flex flex-wrap items-center justify-between gap-3 text-sm text-slate-600"},ot={class:"flex flex-wrap items-center gap-2"},nt=["disabled"],dt=["onClick"],it=["disabled"],ut={class:"w-full max-w-lg rounded-3xl border border-slate-200 bg-white shadow-xl"},pt={class:"popup-body max-h-[500px] overflow-y-auto px-6 pt-4"},vt={class:"mt-4 flex flex-col gap-3"},mt={class:"flex flex-col gap-1 text-xs uppercase tracking-[0.15em] text-slate-500"},ct=["disabled"],xt=["value"],bt=["value"],ft={key:0,class:"text-xs text-rose-700"},yt={class:"flex flex-col gap-1 text-xs uppercase tracking-[0.15em] text-slate-500"},gt={key:1,class:"text-xs text-rose-700"},_t={class:"relative"},kt={class:"flex flex-col gap-1 text-xs uppercase tracking-[0.15em] text-slate-500"},wt={key:0,class:"text-xs text-rose-700"},ht={key:1,class:"absolute left-0 right-0 z-10 mt-2 w-full rounded-2xl border border-slate-200 bg-white text-sm text-slate-700"},Ct=["disabled","onClick"],St={key:2,class:"text-xs text-rose-700"},Vt={key:0,class:"mt-3 rounded-2xl border border-rose-200 bg-rose-50 px-3 py-2 text-xs text-rose-700"},$t={key:1,class:"mt-3 rounded-2xl border border-emerald-200 bg-emerald-50 px-3 py-2 text-xs text-emerald-700"},At={class:"popup-footer flex flex-wrap justify-end gap-3 border-t border-slate-200/80 px-6 py-4"},Ut=["disabled"],Tt=["disabled"],W=6,Nt={__name:"Venues",props:{appName:{type:String,default:"Laravel"},venues:{type:Array,default:()=>[]},navigation:{type:Object,default:()=>({title:"Навигация",data:[]})},activeType:{type:String,default:""},activeTypeSlug:{type:String,default:""},types:{type:Array,default:()=>[]},metros:{type:Array,default:()=>[]},breadcrumbs:{type:Array,default:()=>[]}},setup(y){const g=y,C=Ce(),Z=u(()=>!!C.props.auth?.user),de=u(()=>C.props.auth?.user?.login||""),ie=u(()=>C.props.auth?.user?.permissions??[]),ue=u(()=>C.props.auth?.user?.status==="blocked"),pe=u(()=>!ue.value&&ie.value.includes("venue.create")),$=p(!1),q=p("login"),X=u(()=>g.navigation?.data??g.navigation?.items??[]),Y=u(()=>(X.value?.length??0)>0);V(()=>C.props.errors,l=>{if(l?.email||l?.participant_role_id){q.value="register",$.value=!0;return}l?.login&&(q.value="login",$.value=!0)},{immediate:!0});const S=p(""),A=p(""),E=p(""),U=p(""),z=p("name_asc"),T=p(!1),B=p(!1),m=p(1),Q=p(!1),M=p(""),j=p(""),b=p([]),c=p(""),D=p(!1),G=p(!1);let H=null,L=0;const a=Se({name:"",venue_type_id:"",city:"",metro_id:"",street:"",building:"",str_address:""}),ve=u(()=>g.metros??[]),me=u(()=>{const l=new Map;return g.venues.forEach(e=>{e.type?.alias&&l.set(e.type.alias,e.type.name||e.type.alias)}),Array.from(l.entries()).map(([e,t])=>({alias:e,name:t}))}),ce=[{value:"",label:"Все статусы"},{value:"confirmed",label:"Подтвержденные"},{value:"moderation",label:"На модерации"},{value:"unconfirmed",label:"Неподтвержденные"},{value:"blocked",label:"Заблокированные"}],ee=u(()=>g.types??[]),_=u(()=>ee.value.find(l=>l.alias===g.activeType)??null),xe=u(()=>_.value?`Добавить ${_.value.name?.toLowerCase()}`:"Добавить площадку"),te=l=>l?l.line_name?`${l.name} — ${l.line_name}`:l.name:"",I=l=>(l??"").toString().toLowerCase(),be=u(()=>{const l=I(E.value),e=U.value?Number(U.value):null;return g.venues.filter(t=>!(S.value&&t.type?.alias!==S.value||T.value&&!t.is_my_venue||A.value&&t.status!==A.value||l&&!I(t.address).includes(l)||e&&t.metro?.id!==e))}),se=u(()=>{const l=[...be.value];return l.sort((e,t)=>{const d=I(e.name),K=I(t.name),ae=e.created_at?Date.parse(e.created_at):0,le=e.created_at?Date.parse(t.created_at):0;switch(z.value){case"name_desc":return K.localeCompare(d);case"created_asc":return ae-le;case"created_desc":return le-ae;default:return d.localeCompare(K)}}),l}),F=u(()=>Math.max(1,Math.ceil(se.value.length/W)));V([S,A,E,U,z,T,B],()=>{m.value=1}),V(Z,l=>{l||(T.value=!1)}),V(F,l=>{m.value>l&&(m.value=l)});const J=u(()=>{const l=(m.value-1)*W;return se.value.slice(l,l+W)}),fe=u(()=>{if(!B.value)return[{name:"Все площадки",items:J.value}];const l=new Map;return J.value.forEach(e=>{const t=e.type?.name||"Без типа";l.has(t)||l.set(t,[]),l.get(t).push(e)}),Array.from(l.entries()).map(([e,t])=>({name:e,items:t}))});V(()=>g.activeType,l=>{S.value=l||"",_.value&&(a.venue_type_id=_.value.id)},{immediate:!0});const ye=()=>{M.value="",a.clearErrors(),a.name="",a.venue_type_id=_.value?.id??"",a.city="",a.metro_id="",a.street="",a.building="",a.str_address="",j.value="",b.value=[],c.value="",Q.value=!0},P=()=>{Q.value=!1,a.reset("name","venue_type_id","city","metro_id","street","building","str_address"),a.clearErrors(),b.value=[],c.value=""};V(j,l=>{(l?.trim()??"")===""&&(a.city="",a.metro_id="",a.street="",a.building="",a.str_address="",b.value=[],c.value="")});const ge=()=>{M.value="",a.post("/venues",{preserveScroll:!0,onSuccess:()=>{M.value="Площадка создана.",P()}})},_e=u(()=>!!(a.name?.trim()&&a.venue_type_id&&a.city?.trim()&&a.street?.trim()&&a.building?.trim())),ke=l=>{if(G.value){G.value=!1;return}c.value="",a.city="",a.street="",a.building="",a.metro_id="",a.str_address="",H&&clearTimeout(H);const e=l?.trim()??"";if(e.length<3){b.value=[];return}H=setTimeout(()=>{we(e)},350)},we=async l=>{const e=++L;D.value=!0;try{const t=await fetch(`/integrations/address-suggest?query=${encodeURIComponent(l)}`,{credentials:"same-origin"});if(!t.ok){if(e!==L)return;b.value=[],c.value="Не удалось получить подсказки.";return}const d=await t.json();if(e!==L)return;b.value=d?.suggestions??[],b.value.length?c.value="":c.value="Варианты не найдены."}catch{if(e!==L)return;b.value=[],c.value="Не удалось получить подсказки."}finally{if(e!==L)return;D.value=!1}},he=l=>{if(!l?.has_house){c.value="Выберите вариант с номером дома.";return}G.value=!0,j.value=l.label||"",a.city=l.city||"",a.street=l.street||"",a.building=l.building||"",a.str_address=l.label||"",a.metro_id=l.metro_id||"",b.value=[],c.value=""};return(l,e)=>(r(),o("div",je,[e[37]||(e[37]=s("div",{class:"pointer-events-none absolute -left-28 top-12 h-72 w-72 rounded-full bg-emerald-200/70 blur-3xl"},null,-1)),e[38]||(e[38]=s("div",{class:"pointer-events-none absolute -right-24 -top-24 h-80 w-80 rounded-full bg-amber-200/70 blur-3xl"},null,-1)),s("div",Le,[R(Te,{"app-name":y.appName,"is-authenticated":Z.value,"login-label":de.value,onOpenLogin:e[0]||(e[0]=t=>{q.value="login",$.value=!0})},null,8,["app-name","is-authenticated","login-label"]),s("main",{class:N(["grid gap-6",{"lg:grid-cols-[240px_1fr]":Y.value}])},[Y.value?(r(),re(Me,{key:0,title:y.navigation.title,data:X.value,"active-href":y.activeTypeSlug?`/venues/${y.activeTypeSlug}`:""},null,8,["title","data","active-href"])):x("",!0),s("div",Fe,[R(Ue,{items:y.breadcrumbs},null,8,["items"]),s("div",Ne,[e[20]||(e[20]=s("div",null,[s("h1",{class:"text-3xl font-semibold text-slate-900"},"Список площадок"),s("p",{class:"mt-3 max-w-2xl text-sm text-slate-600"}," Выберите тип площадки, адрес или метро, чтобы быстро найти подходящее место. ")],-1)),pe.value?(r(),o("button",{key:0,class:"rounded-full border border-slate-900 bg-slate-900 px-4 py-2 text-sm font-semibold text-white transition hover:-translate-y-0.5 hover:bg-slate-800",type:"button",onClick:ye},i(xe.value),1)):x("",!0)]),s("div",Oe,[s("label",qe,[e[22]||(e[22]=f(" Тип ",-1)),v(s("select",{"onUpdate:modelValue":e[1]||(e[1]=t=>S.value=t),class:"rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm text-slate-700"},[e[21]||(e[21]=s("option",{value:""},"Все типы",-1)),(r(!0),o(k,null,w(me.value,t=>(r(),o("option",{key:t.alias,value:t.alias},i(t.name),9,Ee))),128))],512),[[O,S.value]])]),s("label",ze,[e[23]||(e[23]=f(" Статус ",-1)),v(s("select",{"onUpdate:modelValue":e[2]||(e[2]=t=>A.value=t),class:"rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm text-slate-700"},[(r(),o(k,null,w(ce,t=>s("option",{key:t.value,value:t.value},i(t.label),9,De)),64))],512),[[O,A.value]])]),s("label",Ie,[e[24]||(e[24]=f(" Адрес ",-1)),v(s("input",{"onUpdate:modelValue":e[3]||(e[3]=t=>E.value=t),class:"rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm text-slate-700",placeholder:"Например, Тверская",type:"text"},null,512),[[h,E.value]])]),s("label",Pe,[e[26]||(e[26]=f(" Метро ",-1)),v(s("select",{"onUpdate:modelValue":e[4]||(e[4]=t=>U.value=t),class:"rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm text-slate-700"},[e[25]||(e[25]=s("option",{value:""},"Любое",-1)),(r(!0),o(k,null,w(ve.value,t=>(r(),o("option",{key:t.id,value:t.id},i(te(t)),9,Re))),128))],512),[[O,U.value]])]),s("label",Ze,[e[28]||(e[28]=f(" Сортировка ",-1)),v(s("select",{"onUpdate:modelValue":e[5]||(e[5]=t=>z.value=t),class:"rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm text-slate-700"},[...e[27]||(e[27]=[s("option",{value:"name_asc"},"Название A-Z",-1),s("option",{value:"name_desc"},"Название Z-A",-1),s("option",{value:"created_desc"},"Дата добавления: новые",-1),s("option",{value:"created_asc"},"Дата добавления: старые",-1)])],512),[[O,z.value]])]),s("label",Qe,[v(s("input",{"onUpdate:modelValue":e[6]||(e[6]=t=>B.value=t),class:"h-4 w-4 rounded border-slate-300",type:"checkbox"},null,512),[[oe,B.value]]),e[29]||(e[29]=f(" Группировать по типу ",-1))]),s("label",Ge,[v(s("input",{"onUpdate:modelValue":e[7]||(e[7]=t=>T.value=t),class:"h-4 w-4 rounded border-slate-300",type:"checkbox",disabled:!Z.value},null,8,He),[[oe,T.value]]),e[30]||(e[30]=f(" Мои площадки ",-1))])]),J.value.length?(r(),o("div",Je,[(r(!0),o(k,null,w(fe.value,t=>(r(),o("div",{key:t.name,class:"space-y-3"},[B.value?(r(),o("h2",Ke,i(t.name),1)):x("",!0),(r(!0),o(k,null,w(t.items,d=>(r(),o("article",{key:d.id,class:"rounded-2xl border border-slate-200 bg-slate-50 p-4"},[s("div",We,[s("div",null,[s("h3",Xe,[d.type_slug?(r(),re(n($e),{key:0,class:"transition hover:text-slate-700",href:`/venues/${d.type_slug}/${d.alias}`},{default:Ve(()=>[f(i(d.name),1)]),_:2},1032,["href"])):(r(),o("span",Ye,i(d.name),1))]),s("p",et,i(d.type?.name||"Тип не указан"),1),d.address?(r(),o("p",tt,i(d.address),1)):x("",!0),d.metro?.name?(r(),o("p",st," Метро: "+i(te(d.metro)),1)):x("",!0)]),s("div",at,[s("span",{class:N(["rounded-full border border-slate-200 bg-slate-50 px-2 py-0.5",{"border-emerald-200 bg-emerald-50 text-emerald-700":d.status==="confirmed","border-amber-200 bg-amber-50 text-amber-800":d.status==="moderation","border-rose-200 bg-rose-50 text-rose-700":d.status==="unconfirmed","border-rose-300 bg-rose-50 text-rose-700":d.status==="blocked"}])},i(d.status==="confirmed"?"Подтвержден":d.status==="moderation"?"На модерации":d.status==="blocked"?"Заблокирован":"Не подтвержден"),3)])])]))),128))]))),128))])):(r(),o("div",lt," По текущим фильтрам площадок не найдено. ")),s("div",rt,[s("div",null,"Страница "+i(m.value)+" из "+i(F.value),1),s("div",ot,[s("button",{class:"rounded-full border border-slate-300 px-3 py-1 text-sm transition disabled:opacity-40",disabled:m.value===1,type:"button",onClick:e[8]||(e[8]=t=>m.value=Math.max(1,m.value-1))}," Назад ",8,nt),(r(!0),o(k,null,w(F.value,t=>(r(),o("button",{key:t,class:N(["h-9 w-9 rounded-full border text-sm transition",t===m.value?"border-slate-900 bg-slate-900 text-white":"border-slate-300 text-slate-700 hover:border-slate-400"]),type:"button",onClick:d=>m.value=t},i(t),11,dt))),128)),s("button",{class:"rounded-full border border-slate-300 px-3 py-1 text-sm transition disabled:opacity-40",disabled:m.value===F.value,type:"button",onClick:e[9]||(e[9]=t=>m.value=Math.min(F.value,m.value+1))}," Вперёд ",8,it)])])])],2),R(Be,{"app-name":y.appName},null,8,["app-name"])]),R(Ae,{"app-name":y.appName,"is-open":$.value,"participant-roles":n(C).props.participantRoles||[],"initial-mode":q.value,onClose:e[10]||(e[10]=t=>$.value=!1)},null,8,["app-name","is-open","participant-roles","initial-mode"]),Q.value?(r(),o("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-slate-900/40 px-4",onClick:ne(P,["self"])},[s("div",ut,[s("form",{class:N({loading:n(a).processing}),onSubmit:ne(ge,["prevent"])},[s("div",{class:"popup-header flex items-center justify-between border-b border-slate-200/80 px-6 py-4"},[e[31]||(e[31]=s("h2",{class:"text-lg font-semibold text-slate-900"},"Новая площадка",-1)),s("button",{class:"rounded-full border border-slate-200 px-2.5 py-1 text-sm text-slate-500 transition hover:border-slate-300 hover:text-slate-700",type:"button","aria-label":"Закрыть",onClick:P}," x ")]),s("div",pt,[e[36]||(e[36]=s("p",{class:"text-sm text-slate-600"},"Заполните обязательные поля для создания площадки.",-1)),s("div",vt,[s("label",mt,[e[33]||(e[33]=f(" Тип ",-1)),v(s("select",{"onUpdate:modelValue":e[11]||(e[11]=t=>n(a).venue_type_id=t),class:"rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm text-slate-700",disabled:!!_.value},[e[32]||(e[32]=s("option",{value:""},"Выберите тип",-1)),(r(!0),o(k,null,w(ee.value,t=>(r(),o("option",{key:t.id,value:t.id},i(t.name),9,xt))),128))],8,ct),[[O,n(a).venue_type_id]]),_.value?(r(),o("input",{key:0,type:"hidden",value:_.value.id},null,8,bt)):x("",!0)]),n(a).errors.venue_type_id?(r(),o("div",ft,i(n(a).errors.venue_type_id),1)):x("",!0),s("label",yt,[e[34]||(e[34]=f(" Название ",-1)),v(s("input",{"onUpdate:modelValue":e[12]||(e[12]=t=>n(a).name=t),class:"rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm text-slate-700",type:"text",placeholder:"Например, Арена 11"},null,512),[[h,n(a).name]])]),n(a).errors.name?(r(),o("div",gt,i(n(a).errors.name),1)):x("",!0),s("div",_t,[s("label",kt,[e[35]||(e[35]=f(" Адрес ",-1)),v(s("input",{"onUpdate:modelValue":e[13]||(e[13]=t=>j.value=t),onInput:e[14]||(e[14]=t=>ke(t.target.value)),class:N(["input-predictive rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm text-slate-700",{"is-loading":D.value}]),type:"text",placeholder:"Начните вводить адрес"},null,34),[[h,j.value]])]),v(s("input",{"onUpdate:modelValue":e[15]||(e[15]=t=>n(a).city=t),type:"hidden"},null,512),[[h,n(a).city]]),v(s("input",{"onUpdate:modelValue":e[16]||(e[16]=t=>n(a).metro_id=t),type:"hidden"},null,512),[[h,n(a).metro_id]]),v(s("input",{"onUpdate:modelValue":e[17]||(e[17]=t=>n(a).street=t),type:"hidden"},null,512),[[h,n(a).street]]),v(s("input",{"onUpdate:modelValue":e[18]||(e[18]=t=>n(a).building=t),type:"hidden"},null,512),[[h,n(a).building]]),v(s("input",{"onUpdate:modelValue":e[19]||(e[19]=t=>n(a).str_address=t),type:"hidden"},null,512),[[h,n(a).str_address]]),c.value?(r(),o("div",wt,i(c.value),1)):!D.value&&b.value.length?(r(),o("div",ht,[(r(!0),o(k,null,w(b.value,(t,d)=>(r(),o("button",{key:`${t.label}-${d}`,class:"block w-full border-b border-slate-100 px-3 py-2 text-left last:border-b-0 hover:bg-slate-50 disabled:cursor-not-allowed disabled:text-slate-400",type:"button",disabled:!t.has_house,onClick:K=>he(t)},i(t.label),9,Ct))),128))])):x("",!0),n(a).errors.city||n(a).errors.street||n(a).errors.building?(r(),o("div",St,i(n(a).errors.city||n(a).errors.street||n(a).errors.building),1)):x("",!0)])]),n(a).errors.venue?(r(),o("div",Vt,i(n(a).errors.venue),1)):M.value?(r(),o("div",$t,i(M.value),1)):x("",!0)]),s("div",At,[s("button",{class:"rounded-full border border-slate-200 px-4 py-2 text-sm text-slate-600 transition hover:-translate-y-0.5 hover:border-slate-300",type:"button",disabled:n(a).processing,onClick:P}," Закрыть ",8,Ut),s("button",{class:"rounded-full border border-slate-900 bg-slate-900 px-4 py-2 text-sm font-semibold text-white transition hover:-translate-y-0.5 hover:bg-slate-800 disabled:cursor-not-allowed disabled:border-slate-300 disabled:bg-slate-200 disabled:text-slate-500 disabled:hover:translate-y-0",type:"submit",disabled:n(a).processing||!_e.value}," Создать ",8,Tt)])],34)])])):x("",!0)]))}};export{Nt as default};
