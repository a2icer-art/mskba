import{a as le,r as y,c as k,w as A,q as ae,p as H,b as r,e as i,d as a,t as u,n as w,j as p,m as x,v as J,h as l,F as T,i as B,k as v,l as K,o}from"./app-BG8bJDk_.js";const re={key:0},oe={key:0,class:"rounded-2xl border border-rose-200 bg-rose-50 px-3 py-2 text-xs text-rose-700"},de={class:"flex flex-col gap-1 text-xs uppercase tracking-[0.15em] text-slate-500"},ne=["value"],ie={key:0,class:"text-xs text-rose-700"},ue={key:2,class:"relative"},pe={class:"flex flex-col gap-1 text-xs uppercase tracking-[0.15em] text-slate-500"},xe={key:0,class:"text-xs text-rose-700"},ve={key:1,class:"absolute left-0 right-0 z-10 mt-2 w-full rounded-2xl border border-slate-200 bg-white text-sm text-slate-700"},be=["onClick"],me={key:2,class:"flex items-center justify-between text-xs text-slate-500"},ce={key:3,class:"text-xs text-rose-700"},fe={key:4,class:"flex flex-col gap-1 text-xs uppercase tracking-[0.15em] text-slate-500"},ye={class:"grid gap-3 md:grid-cols-2"},_e={class:"flex flex-col gap-1 text-xs uppercase tracking-[0.15em] text-slate-500"},ge={class:"flex flex-col gap-1 text-xs uppercase tracking-[0.15em] text-slate-500"},ke={key:5,class:"text-xs text-rose-700"},we={class:"flex flex-col gap-1 text-xs uppercase tracking-[0.15em] text-slate-500"},he={key:6,class:"text-xs text-rose-700"},Se={key:2,class:"mt-4 flex flex-wrap justify-end gap-3"},Ve=["disabled"],Ce={key:1,class:"fixed inset-0 z-50 flex items-center justify-center bg-slate-900/40 px-4"},Ue={class:"w-full max-w-lg rounded-3xl border border-slate-200 bg-white shadow-xl"},Te={class:"popup-body max-h-[500px] overflow-y-auto px-6 pt-4"},Be={key:0,class:"rounded-2xl border border-rose-200 bg-rose-50 px-3 py-2 text-xs text-rose-700"},je={class:"flex flex-col gap-1 text-xs uppercase tracking-[0.15em] text-slate-500"},Ee={key:0,class:"text-xs text-rose-700"},$e={class:"flex flex-col gap-1 text-xs uppercase tracking-[0.15em] text-slate-500"},De=["value"],Fe={key:1,class:"text-xs text-rose-700"},Me={key:2,class:"relative"},Ie={class:"flex flex-col gap-1 text-xs uppercase tracking-[0.15em] text-slate-500"},Oe={key:0,class:"text-xs text-rose-700"},Re={key:1,class:"absolute left-0 right-0 z-10 mt-2 w-full rounded-2xl border border-slate-200 bg-white text-sm text-slate-700"},qe=["onClick"],ze={key:2,class:"flex items-center justify-between text-xs text-slate-500"},Le={key:3,class:"text-xs text-rose-700"},Ne={class:"flex flex-col gap-1 text-xs uppercase tracking-[0.15em] text-slate-500"},Pe={class:"grid gap-3 md:grid-cols-2"},Ge={class:"flex flex-col gap-1 text-xs uppercase tracking-[0.15em] text-slate-500"},Qe={class:"flex flex-col gap-1 text-xs uppercase tracking-[0.15em] text-slate-500"},Ae={key:3,class:"text-xs text-rose-700"},He={class:"popup-footer flex flex-wrap justify-end gap-3 border-t border-slate-200/80 px-6 py-4"},Je=["disabled"],Ke=["disabled"],Xe={__name:"EventCreateModal",props:{isOpen:{type:Boolean,default:!1},embedded:{type:Boolean,default:!1},prefill:{type:Object,default:()=>({})},canBookFallback:{type:Boolean,default:!1},hideSubmit:{type:Boolean,default:!1}},emits:["close","loaded","bookingConflict"],setup(S,{expose:W,emit:X}){const n=S,j=X,e=le({event_type_id:"",title:"",venue_id:"",date:"",starts_time:"",ends_time:"",starts_at:"",ends_at:""}),c=y(""),b=y([]),_=y(!1),f=y("");let E=null,V=0;const h=y(!1),g=y(""),C=y([]),I=y(!1),O=y(null),Y=new Set(["game","training","game_training"]),R=k(()=>e.event_type_id&&C.value.find(d=>String(d.id)===String(e.event_type_id))||null),q=k(()=>R.value&&Y.has(R.value.code)),z=k(()=>(I.value||n.canBookFallback)&&q.value),U=k(()=>!!n.prefill?.venue),L=(d,t)=>!d||!t?"":`${d}T${t}`,$=async()=>{h.value=!0,g.value="",n.prefill?.date&&(e.date=n.prefill.date);const d=new URLSearchParams;n.prefill?.venue&&d.set("venue",n.prefill.venue),n.prefill?.date&&d.set("date",n.prefill.date),n.prefill?.starts_time&&d.set("starts_time",n.prefill.starts_time),n.prefill?.ends_time&&d.set("ends_time",n.prefill.ends_time),n.embedded&&d.set("context","embedded");try{const t=await fetch(`/events/create-modal?${d.toString()}`);if(!t.ok)throw new Error("modal_failed");const s=await t.json();C.value=s?.eventTypes??[],I.value=!!s?.canBook;const m=s?.prefill??{};e.event_type_id="",e.title="",e.venue_id=m?.venue?.id??"",c.value=m?.venue?.label??"",e.date=m?.date??"",e.starts_time=m?.starts_time??"",e.ends_time=m?.ends_time??""}catch{g.value="Не удалось загрузить форму бронирования."}finally{h.value=!1,n.embedded&&(await H(),j("loaded"))}},Z=()=>{e.reset("event_type_id","title","venue_id","date","starts_time","ends_time","starts_at","ends_at"),e.clearErrors(),c.value="",b.value=[],f.value="",g.value=""};A(()=>n.isOpen||n.embedded,d=>{d?(e.clearErrors(),$()):Z()}),A(()=>n.prefill,()=>{n.embedded&&$()},{deep:!0}),ae(()=>{(n.isOpen||n.embedded)&&$()});const D=()=>{j("close")},F=()=>{if(n.embedded&&U.value&&!e.venue_id){e.setError("venue_id","Площадка не выбрана.");return}e.starts_at=L(e.date,e.starts_time),e.ends_at=L(e.date,e.ends_time),e.post("/events",{preserveScroll:!0,onSuccess:D,onError:d=>{const t=String(d?.starts_at||d?.ends_at||"");n.embedded&&t.includes("занят")&&j("bookingConflict")}})},M=k(()=>e.processing||h.value||n.embedded&&U.value&&!e.venue_id?!0:!e.event_type_id||!e.date||!e.starts_time||!e.ends_time),ee=k(()=>!!n.prefill?.date);W({submit:F,isDisabled:M,focusType:async()=>{await H(),O.value?.focus()}});const N=()=>{!q.value&&!U.value&&(e.venue_id="",c.value="",b.value=[],f.value="")},P=d=>{if(e.venue_id="",f.value="",E&&clearTimeout(E),!d||d.trim().length<2){_.value=!1,b.value=[];return}E=setTimeout(()=>{te(d.trim())},250)},te=async d=>{const t=++V;_.value=!0;try{const s=await fetch(`/integrations/venue-suggest?query=${encodeURIComponent(d)}`);if(!s.ok)throw new Error("suggest_failed");const m=await s.json();if(t!==V)return;b.value=m?.suggestions??[]}catch{if(t!==V)return;b.value=[],f.value="Не удалось получить подсказки площадок."}finally{t===V&&(_.value=!1)}},G=d=>{e.venue_id=d.id,c.value=d.label||d.name||"",b.value=[]},Q=()=>{e.venue_id="",c.value="",b.value=[],f.value=""};return(d,t)=>S.embedded?(o(),r("div",re,[a("form",{class:w({loading:l(e).processing}),onSubmit:K(F,["prevent"])},[g.value?(o(),r("div",oe,u(g.value),1)):(o(),r("div",{key:1,class:w(["grid gap-3",{loading:h.value}])},[a("label",de,[t[17]||(t[17]=x(" Тип события ",-1)),p(a("select",{"onUpdate:modelValue":t[0]||(t[0]=s=>l(e).event_type_id=s),ref_key:"typeSelectRef",ref:O,class:"rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm text-slate-700",onChange:N},[t[16]||(t[16]=a("option",{value:""},"Выберите тип",-1)),(o(!0),r(T,null,B(C.value,s=>(o(),r("option",{key:s.id,value:s.id},u(s.label),9,ne))),128))],544),[[J,l(e).event_type_id]])]),l(e).errors.event_type_id?(o(),r("div",ie,u(l(e).errors.event_type_id),1)):i("",!0),U.value?p((o(),r("input",{key:1,"onUpdate:modelValue":t[1]||(t[1]=s=>l(e).venue_id=s),type:"hidden"},null,512)),[[v,l(e).venue_id]]):z.value?(o(),r("div",ue,[a("label",pe,[t[18]||(t[18]=x(" Площадка (опционально) ",-1)),p(a("input",{"onUpdate:modelValue":t[2]||(t[2]=s=>c.value=s),class:w(["input-predictive rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm text-slate-700",{"is-loading":_.value}]),type:"text",placeholder:"Начните вводить название, метро или адрес",onInput:t[3]||(t[3]=s=>P(s.target.value))},null,34),[[v,c.value]])]),f.value?(o(),r("div",xe,u(f.value),1)):!_.value&&b.value.length?(o(),r("div",ve,[(o(!0),r(T,null,B(b.value,(s,m)=>(o(),r("button",{key:`${s.id}-${m}`,class:"block w-full border-b border-slate-100 px-3 py-2 text-left last:border-b-0 hover:bg-slate-50",type:"button",onClick:se=>G(s)},u(s.label),9,be))),128))])):i("",!0),l(e).venue_id?(o(),r("div",me,[t[19]||(t[19]=a("span",null,"Площадка выбрана.",-1)),a("button",{class:"text-xs font-semibold text-slate-600 transition hover:text-slate-900",type:"button",onClick:Q}," Очистить ")])):i("",!0),l(e).errors.venue_id?(o(),r("div",ce,u(l(e).errors.venue_id),1)):i("",!0)])):i("",!0),ee.value?p((o(),r("input",{key:3,"onUpdate:modelValue":t[4]||(t[4]=s=>l(e).date=s),type:"hidden"},null,512)),[[v,l(e).date]]):(o(),r("label",fe,[t[20]||(t[20]=x(" Дата ",-1)),p(a("input",{"onUpdate:modelValue":t[5]||(t[5]=s=>l(e).date=s),class:"rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm text-slate-700",type:"date"},null,512),[[v,l(e).date]])])),a("div",ye,[a("label",_e,[t[21]||(t[21]=x(" Начало ",-1)),p(a("input",{"onUpdate:modelValue":t[6]||(t[6]=s=>l(e).starts_time=s),class:"rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm text-slate-700",type:"time"},null,512),[[v,l(e).starts_time]])]),a("label",ge,[t[22]||(t[22]=x(" Окончание ",-1)),p(a("input",{"onUpdate:modelValue":t[7]||(t[7]=s=>l(e).ends_time=s),class:"rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm text-slate-700",type:"time"},null,512),[[v,l(e).ends_time]])])]),l(e).errors.starts_at||l(e).errors.ends_at?(o(),r("div",ke,u(l(e).errors.starts_at||l(e).errors.ends_at),1)):i("",!0),a("label",we,[t[23]||(t[23]=x(" Название (опционально) ",-1)),p(a("input",{"onUpdate:modelValue":t[8]||(t[8]=s=>l(e).title=s),class:"rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm text-slate-700",type:"text"},null,512),[[v,l(e).title]])]),l(e).errors.title?(o(),r("div",he,u(l(e).errors.title),1)):i("",!0)],2)),S.hideSubmit?i("",!0):(o(),r("div",Se,[a("button",{class:"rounded-full border border-emerald-600 bg-emerald-600 px-4 py-2 text-sm font-semibold text-white transition hover:-translate-y-0.5 hover:bg-emerald-700 disabled:cursor-not-allowed disabled:border-slate-300 disabled:bg-slate-200 disabled:text-slate-500 disabled:hover:translate-y-0",type:"submit",disabled:M.value}," Создать ",8,Ve)]))],34)])):S.isOpen?(o(),r("div",Ce,[a("div",Ue,[a("form",{class:w({loading:l(e).processing}),onSubmit:K(F,["prevent"])},[a("div",{class:"popup-header flex items-center justify-between border-b border-slate-200/80 px-6 py-4"},[t[24]||(t[24]=a("h2",{class:"text-lg font-semibold text-slate-900"},"Новое событие",-1)),a("button",{class:"rounded-full border border-slate-200 px-2.5 py-1 text-sm text-slate-500 transition hover:border-slate-300 hover:text-slate-700",type:"button","aria-label":"Закрыть",onClick:D}," x ")]),a("div",Te,[g.value?(o(),r("div",Be,u(g.value),1)):(o(),r("div",{key:1,class:w(["grid gap-3",{loading:h.value}])},[a("label",je,[t[25]||(t[25]=x(" Название (опционально) ",-1)),p(a("input",{"onUpdate:modelValue":t[9]||(t[9]=s=>l(e).title=s),class:"rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm text-slate-700",type:"text"},null,512),[[v,l(e).title]])]),l(e).errors.title?(o(),r("div",Ee,u(l(e).errors.title),1)):i("",!0),a("label",$e,[t[27]||(t[27]=x(" Тип события ",-1)),p(a("select",{"onUpdate:modelValue":t[10]||(t[10]=s=>l(e).event_type_id=s),class:"rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm text-slate-700",onChange:N},[t[26]||(t[26]=a("option",{value:""},"Выберите тип",-1)),(o(!0),r(T,null,B(C.value,s=>(o(),r("option",{key:s.id,value:s.id},u(s.label),9,De))),128))],544),[[J,l(e).event_type_id]])]),l(e).errors.event_type_id?(o(),r("div",Fe,u(l(e).errors.event_type_id),1)):i("",!0),z.value?(o(),r("div",Me,[a("label",Ie,[t[28]||(t[28]=x(" Площадка (опционально) ",-1)),p(a("input",{"onUpdate:modelValue":t[11]||(t[11]=s=>c.value=s),class:w(["input-predictive rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm text-slate-700",{"is-loading":_.value}]),type:"text",placeholder:"Начните вводить название, метро или адрес",onInput:t[12]||(t[12]=s=>P(s.target.value))},null,34),[[v,c.value]])]),f.value?(o(),r("div",Oe,u(f.value),1)):!_.value&&b.value.length?(o(),r("div",Re,[(o(!0),r(T,null,B(b.value,(s,m)=>(o(),r("button",{key:`${s.id}-${m}`,class:"block w-full border-b border-slate-100 px-3 py-2 text-left last:border-b-0 hover:bg-slate-50",type:"button",onClick:se=>G(s)},u(s.label),9,qe))),128))])):i("",!0),l(e).venue_id?(o(),r("div",ze,[t[29]||(t[29]=a("span",null,"Площадка выбрана.",-1)),a("button",{class:"text-xs font-semibold text-slate-600 transition hover:text-slate-900",type:"button",onClick:Q}," Очистить ")])):i("",!0),l(e).errors.venue_id?(o(),r("div",Le,u(l(e).errors.venue_id),1)):i("",!0)])):i("",!0),a("label",Ne,[t[30]||(t[30]=x(" Дата ",-1)),p(a("input",{"onUpdate:modelValue":t[13]||(t[13]=s=>l(e).date=s),class:"rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm text-slate-700",type:"date"},null,512),[[v,l(e).date]])]),a("div",Pe,[a("label",Ge,[t[31]||(t[31]=x(" Начало ",-1)),p(a("input",{"onUpdate:modelValue":t[14]||(t[14]=s=>l(e).starts_time=s),class:"rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm text-slate-700",type:"time"},null,512),[[v,l(e).starts_time]])]),a("label",Qe,[t[32]||(t[32]=x(" Окончание ",-1)),p(a("input",{"onUpdate:modelValue":t[15]||(t[15]=s=>l(e).ends_time=s),class:"rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm text-slate-700",type:"time"},null,512),[[v,l(e).ends_time]])])]),l(e).errors.starts_at||l(e).errors.ends_at?(o(),r("div",Ae,u(l(e).errors.starts_at||l(e).errors.ends_at),1)):i("",!0)],2))]),a("div",He,[a("button",{class:"rounded-full border border-slate-200 px-4 py-2 text-sm text-slate-600 transition hover:-translate-y-0.5 hover:border-slate-300",type:"button",disabled:l(e).processing,onClick:D}," Закрыть ",8,Je),a("button",{class:"rounded-full border border-emerald-600 bg-emerald-600 px-4 py-2 text-sm font-semibold text-white transition hover:-translate-y-0.5 hover:bg-emerald-700 disabled:cursor-not-allowed disabled:border-slate-300 disabled:bg-slate-200 disabled:text-slate-500 disabled:hover:translate-y-0",type:"submit",disabled:M.value}," Создать ",8,Ke)])],34)])])):i("",!0)}};export{Xe as _};
