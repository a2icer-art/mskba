import{c as j,a as E,r as b,u as ae,w as ne,b as l,d as e,f as F,e as u,n as _,g as Q,m as D,j as w,v as W,h as r,F as C,i as S,l as P,k as R,t as n,A as ie,o,z as de,B as pe}from"./app-BG8bJDk_.js";import{_ as ue}from"./Breadcrumbs-BJkTr2TQ.js";import{_ as ce,a as xe}from"./MainHeader-CSzL04-A.js";import{_ as be}from"./MainSidebar-Gh5823Zl.js";import{_ as ve}from"./SystemNoticeStack-D6BD3byq.js";const me={class:"relative min-h-screen overflow-hidden bg-[#f7f1e6] text-slate-900"},fe={class:"relative mx-auto flex max-w-[1360px] flex-col gap-8 px-6 py-8"},ye={class:"rounded-3xl border border-slate-200/80 bg-white/90 p-6 shadow-sm page-content-wrapper"},ge={class:"mt-6 rounded-2xl border border-slate-200 bg-slate-50 p-4"},he={class:"flex flex-wrap items-center gap-4"},_e={class:"flex flex-col gap-1 text-xs uppercase tracking-[0.15em] text-slate-500"},we=["value"],ke={class:"flex flex-col gap-1 text-xs uppercase tracking-[0.15em] text-slate-500"},je=["value"],Ce={key:0,class:"mt-6 w-full overflow-x-auto rounded-2xl border border-slate-200"},Se={class:"min-w-max"},$e=["onClick"],Ve=["title"],Ee={class:"flex flex-wrap items-center gap-2"},Fe=["disabled","onClick"],Ne=["disabled","onClick"],Oe=["disabled","onClick"],Te=["title"],Ae={key:1,class:"mt-6 rounded-2xl border border-dashed border-slate-200 bg-slate-50 px-4 py-6 text-sm text-slate-500"},Me={key:2,class:"mt-6 flex flex-wrap items-center gap-2 text-sm"},Le={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-slate-900/40 px-4"},Ue={class:"w-full max-w-lg rounded-3xl border border-slate-200 bg-white shadow-xl"},ze={class:"popup-body max-h-[500px] overflow-y-auto px-6 pt-4"},Be={key:0,class:"mt-2 text-xs text-rose-700"},De={class:"popup-footer flex flex-wrap justify-end gap-3 border-t border-slate-200/80 px-6 py-4"},Pe=["disabled"],Re=["disabled"],He={key:1,class:"fixed inset-0 z-50 flex items-center justify-center bg-slate-900/40 px-4"},Ge={class:"w-full max-w-lg rounded-3xl border border-slate-200 bg-white shadow-xl"},Je={class:"popup-body max-h-[500px] overflow-y-auto px-6 pt-4"},Ke={key:0,class:"mt-2 text-xs text-rose-700"},Qe={class:"popup-footer flex flex-wrap justify-end gap-3 border-t border-slate-200/80 px-6 py-4"},We=["disabled"],Xe=["disabled"],Ye={key:2,class:"fixed inset-0 z-50 flex items-center justify-center bg-slate-900/40 px-4"},Ze={class:"w-full max-w-xl rounded-3xl border border-slate-200 bg-white shadow-xl"},qe={class:"popup-body max-h-[520px] overflow-y-auto px-6 pt-4"},Ie={class:"mt-4 rounded-2xl border border-slate-200 bg-slate-50 px-4 py-3 text-sm text-slate-700"},et={class:"flex flex-wrap items-center justify-between gap-2"},tt={class:"font-semibold"},st={class:"mt-3 grid gap-2 text-sm"},rt={class:"flex items-center justify-between"},ot={class:"flex items-center justify-between"},lt={class:"mt-4 grid gap-3"},at={class:"max-h-[260px] overflow-y-auto rounded-2xl border border-slate-200 bg-white p-3"},nt={key:0,class:"grid gap-2 text-sm text-slate-700"},it=["value"],dt={key:1,class:"text-sm text-slate-500"},pt={key:0,class:"text-xs text-rose-700"},ut={class:"flex flex-col gap-1 text-xs uppercase tracking-[0.15em] text-slate-500"},ct={class:"popup-footer flex flex-wrap justify-end gap-3 border-t border-slate-200/80 px-6 py-4"},xt=["disabled"],bt=["disabled"],vt={key:3,class:"fixed inset-0 z-50 flex items-center justify-center bg-slate-900/40 px-4"},mt={class:"w-full max-w-lg rounded-3xl border border-slate-200 bg-white shadow-xl"},ft={class:"popup-body max-h-[500px] overflow-y-auto px-6 pt-4"},yt={class:"rounded-2xl border border-slate-200 bg-slate-50 px-4 py-3 text-sm text-slate-700"},gt={class:"flex flex-wrap items-center justify-between gap-2"},ht={class:"font-semibold"},_t={class:"mt-3 grid gap-2 text-sm"},wt={class:"flex items-center justify-between"},kt={class:"flex items-center justify-between"},jt={class:"flex items-center justify-between"},Ct={class:"flex items-center justify-between"},Nt={__name:"ContractsModeration",props:{appName:{type:String,default:"Laravel"},navigation:{type:Object,default:()=>({title:"Разделы",data:[]})},activeHref:{type:String,default:""},filters:{type:Object,default:()=>({status:"",sort:"submitted_at_desc"})},statusOptions:{type:Array,default:()=>[]},sortOptions:{type:Array,default:()=>[]},requests:{type:Object,default:()=>({data:[],links:[]})},breadcrumbs:{type:Array,default:()=>[]},permissions:{type:Array,default:()=>[]},supervisorPermissionCodes:{type:Array,default:()=>[]}},setup(c){const y=c,H=j(()=>y.navigation?.data??[]),G=j(()=>(H.value?.length??0)>0),m=E({status:y.filters?.status??"",sort:y.filters?.sort??"submitted_at_desc"}),g=b(""),x=b(""),N=b(!1),$=b(null),d=E({reason:""}),O=b(!1),V=b(null),p=E({reason:""}),i=E({permissions:[],comment:""}),T=b(!1),v=b(null),A=b(!1),f=b(null),h=ae(),X={pending:"На модерации",approved:"Подтверждено",clarification:"Требуются уточнения",rejected:"Отклонено"},M={owner:"Владелец",supervisor:"Супервайзер"},L=a=>{if(!a)return"—";const t=new Date(a);return Number.isNaN(t.getTime())?a:t.toLocaleString("ru-RU")},Y=()=>{ie.get("/admin/contracts-moderation",{status:m.status,sort:m.sort},{preserveState:!0,replace:!0})};ne(()=>[m.status,m.sort],()=>{Y()});const Z=a=>{g.value="",x.value="",v.value=a,i.permissions=[],i.comment="",i.clearErrors(),T.value=!0},U=()=>{T.value=!1,v.value=null,i.reset("permissions","comment"),i.clearErrors()},q=()=>{v.value&&i.post(`/admin/contracts-moderation/${v.value.id}/approve`,{preserveScroll:!0,onSuccess:()=>{g.value="Контракт подтвержден.",U()},onError:a=>{x.value=a.moderation||i.errors.permissions||"Не удалось подтвердить заявку."},onFinish:()=>{h.props?.errors?.moderation&&(x.value=h.props.errors.moderation)}})},I=a=>{g.value="",x.value="",$.value=a,d.reason="",d.clearErrors(),N.value=!0},z=()=>{N.value=!1,$.value=null,d.reset("reason"),d.clearErrors()},ee=a=>{g.value="",x.value="",V.value=a,p.reason="",p.clearErrors(),O.value=!0},B=()=>{O.value=!1,V.value=null,p.reset("reason"),p.clearErrors()},te=()=>{V.value&&p.post(`/admin/contracts-moderation/${V.value.id}/clarify`,{preserveScroll:!0,onSuccess:()=>{g.value="Запрошены уточнения по заявке.",B()},onError:a=>{x.value=a.moderation||p.errors.reason||"Не удалось запросить уточнения."},onFinish:()=>{h.props?.errors?.moderation&&(x.value=h.props.errors.moderation)}})},se=()=>{$.value&&d.post(`/admin/contracts-moderation/${$.value.id}/reject`,{preserveScroll:!0,onSuccess:()=>{g.value="Заявка отклонена.",z()},onError:a=>{x.value=a.moderation||d.errors.reason||"Не удалось отклонить заявку."},onFinish:()=>{h.props?.errors?.moderation&&(x.value=h.props.errors.moderation)}})},re=a=>{f.value=a,A.value=!0},J=()=>{A.value=!1,f.value=null},oe=j(()=>(y.requests?.data?.length??0)>0),le=j(()=>new Set(y.supervisorPermissionCodes||[])),K=j(()=>v.value?v.value.contract_type==="supervisor"?y.permissions.filter(a=>le.value.has(a.code)):y.permissions:[]);return(a,t)=>(o(),l("div",me,[t[27]||(t[27]=e("div",{class:"pointer-events-none absolute -left-28 top-12 h-72 w-72 rounded-full bg-emerald-200/70 blur-3xl"},null,-1)),t[28]||(t[28]=e("div",{class:"pointer-events-none absolute -right-24 -top-24 h-80 w-80 rounded-full bg-amber-200/70 blur-3xl"},null,-1)),F(ve,{success:g.value,error:x.value},null,8,["success","error"]),e("div",fe,[F(ce,{"app-name":c.appName,"is-authenticated":!!a.$page.props.auth?.user,"login-label":a.$page.props.auth?.user?.login},null,8,["app-name","is-authenticated","login-label"]),e("main",{class:_(["grid gap-6",{"lg:grid-cols-[240px_1fr]":G.value}])},[G.value?(o(),Q(be,{key:0,title:c.navigation.title,data:H.value,"active-href":c.activeHref},null,8,["title","data","active-href"])):u("",!0),e("div",ye,[F(ue,{items:c.breadcrumbs},null,8,["items"]),t[9]||(t[9]=e("h1",{class:"text-3xl font-semibold text-slate-900"},"Модерация контрактов",-1)),e("div",ge,[e("div",he,[e("label",_e,[t[6]||(t[6]=D(" Статус ",-1)),w(e("select",{"onUpdate:modelValue":t[0]||(t[0]=s=>r(m).status=s),class:"rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm text-slate-700"},[(o(!0),l(C,null,S(c.statusOptions,s=>(o(),l("option",{key:s.value,value:s.value},n(s.label),9,we))),128))],512),[[W,r(m).status]])]),e("label",ke,[t[7]||(t[7]=D(" Сортировка ",-1)),w(e("select",{"onUpdate:modelValue":t[1]||(t[1]=s=>r(m).sort=s),class:"rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm text-slate-700"},[(o(!0),l(C,null,S(c.sortOptions,s=>(o(),l("option",{key:s.value,value:s.value},n(s.label),9,je))),128))],512),[[W,r(m).sort]])])])]),oe.value?(o(),l("div",Ce,[e("div",Se,[t[8]||(t[8]=e("div",{class:"grid grid-cols-[200px_140px_140px_140px_220px_220px_160px_160px_160px] gap-4 bg-slate-50 px-4 py-3 text-xs uppercase tracking-[0.15em] text-slate-500 whitespace-nowrap"},[e("span",null,"Площадка"),e("span",null,"Тип"),e("span",null,"Заявитель"),e("span",null,"Статус"),e("span",null,"Действия"),e("span",null,"Комментарий"),e("span",null,"Отправлено"),e("span",null,"Решение"),e("span",null,"Кто решил")],-1)),(o(!0),l(C,null,S(c.requests.data,s=>(o(),l("div",{key:s.id,class:"grid grid-cols-[200px_140px_140px_140px_220px_220px_160px_160px_160px] gap-4 border-t border-slate-100 px-4 py-4 text-sm text-slate-700 whitespace-nowrap"},[e("div",null,[e("button",{class:"text-left text-sm font-medium text-slate-800 transition hover:text-slate-700",type:"button",onClick:k=>re(s)},n(s.venue?.name||"—"),9,$e)]),e("div",null,n(M[s.contract_type]||"—"),1),e("div",null,n(s.submitter?.login||"—"),1),e("div",null,[e("span",{class:_(["rounded-full border border-slate-200 bg-slate-50 px-2 py-0.5 text-xs font-semibold text-slate-600",{"border-amber-200 bg-amber-50 text-amber-800":s.status==="pending","border-emerald-200 bg-emerald-50 text-emerald-700":s.status==="approved","border-sky-200 bg-sky-50 text-sky-700":s.status==="clarification","border-rose-200 bg-rose-50 text-rose-700":s.status==="rejected"}]),title:s.submitted_at?L(s.submitted_at):void 0},n(X[s.status]||"—"),11,Ve)]),e("div",Ee,[s.status==="pending"||s.status==="clarification"?(o(),l("button",{key:0,class:"rounded-full border border-emerald-300 bg-emerald-50 px-3 py-1 text-xs font-semibold text-emerald-800 transition hover:-translate-y-0.5 hover:border-emerald-400",type:"button",disabled:r(i).processing,onClick:k=>Z(s)}," Подтвердить ",8,Fe)):u("",!0),s.status==="pending"||s.status==="clarification"?(o(),l("button",{key:1,class:"rounded-full border border-sky-300 bg-sky-50 px-3 py-1 text-xs font-semibold text-sky-700 transition hover:-translate-y-0.5 hover:border-sky-400",type:"button",disabled:r(p).processing,onClick:k=>ee(s)}," Требуются уточнения ",8,Ne)):u("",!0),s.status==="pending"||s.status==="clarification"?(o(),l("button",{key:2,class:"rounded-full border border-rose-300 bg-rose-50 px-3 py-1 text-xs font-semibold text-rose-700 transition hover:-translate-y-0.5 hover:border-rose-400",type:"button",disabled:r(d).processing,onClick:k=>I(s)}," Отклонить ",8,Oe)):u("",!0)]),e("div",{class:"truncate",title:s.comment||""},n(s.comment||"—"),9,Te),e("div",null,n(s.submitted_at?L(s.submitted_at):"—"),1),e("div",null,n(s.reviewed_at?L(s.reviewed_at):"—"),1),e("div",null,n(s.reviewer?.login||"—"),1)]))),128))])])):(o(),l("div",Ae," Заявки не найдены. ")),c.requests.links?.length?(o(),l("div",Me,[(o(!0),l(C,null,S(c.requests.links,s=>(o(),Q(r(de),{key:s.label,class:_(["rounded-full border border-slate-200 px-3 py-1 text-slate-600 transition hover:-translate-y-0.5 hover:border-slate-300",{"bg-slate-900 text-white":s.active,"pointer-events-none opacity-50":!s.url}]),href:s.url||"",innerHTML:s.label},null,8,["class","href","innerHTML"]))),128))])):u("",!0)])],2),F(xe,{"app-name":c.appName},null,8,["app-name"])]),N.value?(o(),l("div",Le,[e("div",Ue,[e("form",{class:_({loading:r(d).processing}),onSubmit:P(se,["prevent"])},[e("div",{class:"popup-header flex items-center justify-between border-b border-slate-200/80 px-6 py-4"},[t[10]||(t[10]=e("h2",{class:"text-lg font-semibold text-slate-900"},"Отклонить заявку",-1)),e("button",{class:"rounded-full border border-slate-200 px-2.5 py-1 text-sm text-slate-500 transition hover:border-slate-300 hover:text-slate-700",type:"button","aria-label":"Закрыть",onClick:z}," x ")]),e("div",ze,[t[11]||(t[11]=e("p",{class:"text-sm text-slate-600"}," Укажите причину отклонения. Она будет показана заявителю. ",-1)),w(e("textarea",{"onUpdate:modelValue":t[2]||(t[2]=s=>r(d).reason=s),class:"mt-4 min-h-[120px] w-full rounded-2xl border border-slate-200 bg-slate-50 px-4 py-3 text-sm text-slate-700 focus:border-slate-400 focus:outline-none",placeholder:"Причина отклонения (необязательно)"},null,512),[[R,r(d).reason]]),r(d).errors.reason?(o(),l("div",Be,n(r(d).errors.reason),1)):u("",!0)]),e("div",De,[e("button",{class:"rounded-full border border-slate-200 px-4 py-2 text-sm text-slate-600 transition hover:-translate-y-0.5 hover:border-slate-300",type:"button",disabled:r(d).processing,onClick:z}," Закрыть ",8,Pe),e("button",{class:"rounded-full border border-rose-600 bg-rose-600 px-4 py-2 text-sm font-semibold text-white transition hover:-translate-y-0.5 hover:bg-rose-700",type:"submit",disabled:r(d).processing}," Отклонить ",8,Re)])],34)])])):u("",!0),O.value?(o(),l("div",He,[e("div",Ge,[e("form",{class:_({loading:r(p).processing}),onSubmit:P(te,["prevent"])},[e("div",{class:"popup-header flex items-center justify-between border-b border-slate-200/80 px-6 py-4"},[t[12]||(t[12]=e("h2",{class:"text-lg font-semibold text-slate-900"},"Запросить уточнения",-1)),e("button",{class:"rounded-full border border-slate-200 px-2.5 py-1 text-sm text-slate-500 transition hover:border-slate-300 hover:text-slate-700",type:"button","aria-label":"Закрыть",onClick:B}," x ")]),e("div",Je,[t[13]||(t[13]=e("p",{class:"text-sm text-slate-600"}," Укажите, какие уточнения нужны. Комментарий будет показан заявителю. ",-1)),w(e("textarea",{"onUpdate:modelValue":t[3]||(t[3]=s=>r(p).reason=s),class:"mt-4 min-h-[120px] w-full rounded-2xl border border-slate-200 bg-slate-50 px-4 py-3 text-sm text-slate-700 focus:border-slate-400 focus:outline-none",placeholder:"Комментарий (необязательно)"},null,512),[[R,r(p).reason]]),r(p).errors.reason?(o(),l("div",Ke,n(r(p).errors.reason),1)):u("",!0)]),e("div",Qe,[e("button",{class:"rounded-full border border-slate-200 px-4 py-2 text-sm text-slate-600 transition hover:-translate-y-0.5 hover:border-slate-300",type:"button",disabled:r(p).processing,onClick:B}," Закрыть ",8,We),e("button",{class:"rounded-full border border-sky-600 bg-sky-600 px-4 py-2 text-sm font-semibold text-white transition hover:-translate-y-0.5 hover:bg-sky-700",type:"submit",disabled:r(p).processing}," Запросить ",8,Xe)])],34)])])):u("",!0),T.value?(o(),l("div",Ye,[e("div",Ze,[e("form",{class:_({loading:r(i).processing}),onSubmit:P(q,["prevent"])},[e("div",{class:"popup-header flex items-center justify-between border-b border-slate-200/80 px-6 py-4"},[t[14]||(t[14]=e("h2",{class:"text-lg font-semibold text-slate-900"},"Подтвердить контракт",-1)),e("button",{class:"rounded-full border border-slate-200 px-2.5 py-1 text-sm text-slate-500 transition hover:border-slate-300 hover:text-slate-700",type:"button","aria-label":"Закрыть",onClick:U}," x ")]),e("div",qe,[t[20]||(t[20]=e("p",{class:"text-sm text-slate-600"}," Заявка будет подтверждена, а пользователю назначится контракт. ",-1)),e("div",Ie,[e("div",et,[t[15]||(t[15]=e("span",{class:"text-xs uppercase tracking-[0.15em] text-slate-500"},"Площадка",-1)),e("span",tt,n(v.value?.venue?.name||"—"),1)]),e("div",st,[e("div",rt,[t[16]||(t[16]=e("span",{class:"text-xs uppercase tracking-[0.15em] text-slate-500"},"Тип",-1)),e("span",null,n(M[v.value?.contract_type]||"—"),1)]),e("div",ot,[t[17]||(t[17]=e("span",{class:"text-xs uppercase tracking-[0.15em] text-slate-500"},"Заявитель",-1)),e("span",null,n(v.value?.submitter?.login||"—"),1)])])]),e("div",lt,[t[19]||(t[19]=e("div",{class:"text-xs uppercase tracking-[0.15em] text-slate-500"},"Права",-1)),e("div",at,[K.value.length?(o(),l("div",nt,[(o(!0),l(C,null,S(K.value,s=>(o(),l("label",{key:s.code,class:"flex items-center gap-2"},[w(e("input",{"onUpdate:modelValue":t[4]||(t[4]=k=>r(i).permissions=k),value:s.code,type:"checkbox",class:"h-4 w-4 rounded border-slate-300 text-slate-900"},null,8,it),[[pe,r(i).permissions]]),e("span",null,n(s.label),1)]))),128))])):(o(),l("p",dt,"Нет доступных прав для назначения."))]),r(i).errors.permissions?(o(),l("div",pt,n(r(i).errors.permissions),1)):u("",!0),e("label",ut,[t[18]||(t[18]=D(" Комментарий ",-1)),w(e("textarea",{"onUpdate:modelValue":t[5]||(t[5]=s=>r(i).comment=s),class:"min-h-[96px] rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm text-slate-700"},null,512),[[R,r(i).comment]])])])]),e("div",ct,[e("button",{class:"rounded-full border border-slate-200 px-4 py-2 text-sm text-slate-600 transition hover:-translate-y-0.5 hover:border-slate-300",type:"button",disabled:r(i).processing,onClick:U}," Закрыть ",8,xt),e("button",{class:"rounded-full border border-emerald-600 bg-emerald-600 px-4 py-2 text-sm font-semibold text-white transition hover:-translate-y-0.5 hover:bg-emerald-700",type:"submit",disabled:r(i).processing}," Подтвердить ",8,bt)])],34)])])):u("",!0),A.value?(o(),l("div",vt,[e("div",mt,[e("div",{class:"popup-header flex items-center justify-between border-b border-slate-200/80 px-6 py-4"},[t[21]||(t[21]=e("h2",{class:"text-lg font-semibold text-slate-900"},"Данные заявки",-1)),e("button",{class:"rounded-full border border-slate-200 px-2.5 py-1 text-sm text-slate-500 transition hover:border-slate-300 hover:text-slate-700",type:"button","aria-label":"Закрыть",onClick:J}," x ")]),e("div",ft,[e("div",yt,[e("div",gt,[t[22]||(t[22]=e("span",{class:"text-xs uppercase tracking-[0.15em] text-slate-500"},"Площадка",-1)),e("span",ht,n(f.value?.venue?.name||"—"),1)]),e("div",_t,[e("div",wt,[t[23]||(t[23]=e("span",{class:"text-xs uppercase tracking-[0.15em] text-slate-500"},"Тип контракта",-1)),e("span",null,n(M[f.value?.contract_type]||"—"),1)]),e("div",kt,[t[24]||(t[24]=e("span",{class:"text-xs uppercase tracking-[0.15em] text-slate-500"},"Заявитель",-1)),e("span",null,n(f.value?.submitter?.login||"—"),1)]),e("div",jt,[t[25]||(t[25]=e("span",{class:"text-xs uppercase tracking-[0.15em] text-slate-500"},"Комментарий",-1)),e("span",null,n(f.value?.comment||"—"),1)]),e("div",Ct,[t[26]||(t[26]=e("span",{class:"text-xs uppercase tracking-[0.15em] text-slate-500"},"Решение",-1)),e("span",null,n(f.value?.review_comment||f.value?.reject_reason||"—"),1)])])])]),e("div",{class:"popup-footer flex flex-wrap justify-end gap-3 border-t border-slate-200/80 px-6 py-4"},[e("button",{class:"rounded-full border border-slate-200 px-4 py-2 text-sm text-slate-600 transition hover:-translate-y-0.5 hover:border-slate-300",type:"button",onClick:J}," Закрыть ")])])])):u("",!0)]))}};export{Nt as default};
