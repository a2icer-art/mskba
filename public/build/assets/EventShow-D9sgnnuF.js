import{u as me,c as b,r as v,a as O,b as n,d as t,e as d,f as w,t as l,F as j,i as A,l as H,n as L,h as i,m as k,j as N,k as $,o}from"./app-BG8bJDk_.js";import{_ as ce}from"./Breadcrumbs-BJkTr2TQ.js";import{_ as pe,a as xe}from"./MainHeader-CSzL04-A.js";import{_ as be}from"./SystemNoticeStack-D6BD3byq.js";const ve={class:"relative min-h-screen overflow-hidden bg-[#f7f1e6] text-slate-900"},fe={class:"relative mx-auto flex max-w-[1360px] flex-col gap-8 px-6 py-8"},_e={class:"grid gap-6"},ge={class:"rounded-3xl border border-slate-200/80 bg-white/90 p-6 shadow-sm page-content-wrapper"},ye={class:"flex flex-wrap items-center gap-4"},he={class:"flex-1"},we={class:"text-3xl font-semibold text-slate-900"},ke={class:"mt-2 text-sm text-slate-600"},Ne={class:"ml-auto flex flex-wrap items-center justify-end gap-2"},$e={class:"mt-4 text-sm text-slate-700"},Se={class:"mt-1"},De={class:"mt-3 flex flex-wrap gap-2 text-xs font-semibold uppercase tracking-[0.15em]"},Te={key:0,class:"rounded-full border border-emerald-200 bg-emerald-50 px-2 py-0.5 text-emerald-700"},Me={key:1,class:"rounded-full border border-rose-200 bg-rose-50 px-2 py-0.5 text-rose-700"},Be={class:"mt-8"},Ce={key:0,class:"mt-4 rounded-2xl border border-dashed border-slate-200 bg-white px-4 py-6 text-sm text-slate-500"},je={key:1,class:"mt-4 grid gap-3"},Le={class:"flex flex-wrap items-center justify-between gap-4"},Ve={class:"text-sm font-semibold text-slate-900"},Ie={class:"mt-1 text-xs uppercase tracking-[0.15em] text-slate-500"},Ee={class:"text-sm text-slate-700"},Ue={key:0,class:"mt-3 text-sm text-slate-700"},Re={class:"mt-1"},Fe={key:1,class:"mt-3 text-sm text-slate-700"},ze={class:"mt-1"},Pe={key:2,class:"mt-3 text-sm text-slate-700"},qe={class:"mt-1"},Oe={key:3,class:"mt-3 text-sm text-slate-700"},Ae={class:"mt-1"},He={key:4,class:"mt-3 text-sm text-slate-700"},Qe={class:"mt-1"},Ye={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-slate-900/40 px-4"},Ge={class:"w-full max-w-lg rounded-3xl border border-slate-200 bg-white shadow-xl"},Je={class:"popup-body max-h-[500px] overflow-y-auto px-6 pt-4"},Ke={class:"grid gap-3"},We={class:"relative"},Xe={class:"flex flex-col gap-1 text-xs uppercase tracking-[0.15em] text-slate-500"},Ze={key:0,class:"text-xs text-rose-700"},et={key:1,class:"absolute left-0 right-0 z-10 mt-2 w-full rounded-2xl border border-slate-200 bg-white text-sm text-slate-700"},tt=["onClick"],st={key:2,class:"flex items-center justify-between text-xs text-slate-500"},at={key:3,class:"text-xs text-rose-700"},rt={class:"flex flex-col gap-1 text-xs uppercase tracking-[0.15em] text-slate-500"},nt={class:"text-xs text-slate-500"},ot={class:"grid gap-3 md:grid-cols-2"},lt={class:"flex flex-col gap-1 text-xs uppercase tracking-[0.15em] text-slate-500"},it={class:"flex flex-col gap-1 text-xs uppercase tracking-[0.15em] text-slate-500"},dt={class:"text-xs text-slate-500"},ut={key:0,class:"text-xs text-rose-700"},mt={key:1,class:"text-xs text-rose-700"},ct={class:"popup-footer flex flex-wrap justify-end gap-3 border-t border-slate-200/80 px-6 py-4"},pt=["disabled"],xt=["disabled"],bt={key:1,class:"fixed inset-0 z-50 flex items-center justify-center bg-slate-900/40 px-4"},vt={class:"w-full max-w-lg rounded-3xl border border-slate-200 bg-white shadow-xl"},ft={class:"popup-body max-h-[500px] overflow-y-auto px-6 pt-4"},_t={class:"text-sm text-slate-600"},gt={class:"popup-footer flex flex-wrap justify-end gap-3 border-t border-slate-200/80 px-6 py-4"},yt=["disabled"],ht=["disabled"],V=15,I=30,St={__name:"EventShow",props:{appName:{type:String,default:"Laravel"},event:{type:Object,default:null},bookings:{type:Array,default:()=>[]},canBook:{type:Boolean,default:!1},bookingDeadlinePassed:{type:Boolean,default:!1},canDelete:{type:Boolean,default:!1},breadcrumbs:{type:Array,default:()=>[]}},setup(u){const c=u,E=me(),Q=b(()=>E.props?.flash?.notice??""),Y=b(()=>E.props?.errors?.booking??""),G=b(()=>c.bookings.length>0),U=b(()=>c.bookings.some(s=>s.status==="approved")),J=b(()=>c.bookings.some(s=>s.status==="cancelled")),K=s=>s==="awaiting_payment"?"Ожидает оплату":s==="paid"?"Оплачено":s==="approved"?"Подтверждено":s==="cancelled"?"Отменено":"Ожидает",W=s=>s==null||Number.isNaN(Number(s))?"—":`${Number(s)} ₽`,R=s=>s?s.payment_partial_amount_minor?s.payment_partial_amount_minor:s.payment_amount_minor?s.payment_amount_minor:s.payment_total_amount_minor?s.payment_total_amount_minor:null:null,S=v(!1),D=v(!1),r=O({venue_id:"",date:"",starts_time:"",ends_time:"",starts_at:"",ends_at:""}),p=v({leadMinutes:V,minIntervalMinutes:I}),_=v(""),x=v([]),g=v(!1),f=v("");let T=null,y=0;const X=()=>{r.clearErrors(),!r.date&&c.event?.starts_at&&(r.date=ie(c.event.starts_at)),!r.starts_time&&c.event?.starts_at&&(r.starts_time=z(c.event.starts_at)),!r.ends_time&&c.event?.ends_at&&(r.ends_time=z(c.event.ends_at)),S.value=!0},M=()=>{r.reset("venue_id","date","starts_time","ends_time","starts_at","ends_at"),r.clearErrors(),_.value="",x.value=[],f.value="",S.value=!1},Z=()=>{r.starts_at=P(r.date,r.starts_time),r.ends_at=P(r.date,r.ends_time),r.post(`/events/${c.event?.id}/bookings`,{preserveScroll:!0,onSuccess:M})},ee=()=>{D.value=!0},B=()=>{D.value=!1},h=O({}),te=()=>{h.delete(`/events/${c.event?.id}`,{preserveScroll:!0,onSuccess:B})},se=b(()=>r.processing?!0:!r.venue_id||!r.date||!r.starts_time||!r.ends_time||C.value!==""),ae=s=>{if(r.venue_id="",f.value="",T&&clearTimeout(T),!s||s.trim().length<2){g.value=!1,x.value=[];return}T=setTimeout(()=>{re(s.trim())},250)},re=async s=>{const e=++y;g.value=!0;try{const a=await fetch(`/integrations/venue-suggest?query=${encodeURIComponent(s)}`);if(!a.ok)throw new Error("suggest_failed");const m=await a.json();if(e!==y)return;x.value=m?.suggestions??[]}catch{if(e!==y)return;x.value=[],f.value="Не удалось получить подсказки площадок."}finally{e===y&&(g.value=!1)}},ne=s=>{r.venue_id=s.id,_.value=s.label||s.name||"",x.value=[],p.value={leadMinutes:Number(s.booking_lead_time_minutes)||V,minIntervalMinutes:Number(s.booking_min_interval_minutes)||I}},oe=()=>{r.venue_id="",_.value="",x.value=[],f.value="",p.value={leadMinutes:V,minIntervalMinutes:I}},le=s=>{if(!s)return"—";const e=new Date(s);return Number.isNaN(e.getTime())?s:e.toLocaleString("ru-RU")},F=(s,e)=>{if(!s||!e)return"—";const a=new Date(s),m=new Date(e);if(Number.isNaN(a.getTime())||Number.isNaN(m.getTime()))return`${s} – ${e}`;const q=a.toLocaleDateString("ru-RU"),de=a.toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit"}),ue=m.toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit"});return`${q}, ${de} – ${ue}`},ie=s=>{if(!s)return"";const e=new Date(s);if(Number.isNaN(e.getTime()))return"";const a=m=>String(m).padStart(2,"0");return`${e.getFullYear()}-${a(e.getMonth()+1)}-${a(e.getDate())}`},z=s=>{if(!s)return"";const e=new Date(s);if(Number.isNaN(e.getTime()))return"";const a=m=>String(m).padStart(2,"0");return`${a(e.getHours())}:${a(e.getMinutes())}`},P=(s,e)=>!s||!e?"":`${s}T${e}`,C=b(()=>{if(!r.date||!r.starts_time)return"";const s=new Date(`${r.date}T${r.starts_time}`);if(Number.isNaN(s.getTime()))return"";const e=new Date;if(e.setMinutes(e.getMinutes()+p.value.leadMinutes),s<e)return`Бронирование возможно не ранее чем через ${p.value.leadMinutes} мин.`;if(!r.ends_time)return"";const a=new Date(`${r.date}T${r.ends_time}`);if(Number.isNaN(a.getTime()))return"";const m=new Date(s.getTime()+p.value.minIntervalMinutes*6e4);return a<m?`Длительность бронирования должна быть не менее ${p.value.minIntervalMinutes} мин.`:""});return(s,e)=>(o(),n(j,null,[t("div",ve,[e[12]||(e[12]=t("div",{class:"pointer-events-none absolute -left-28 top-12 h-72 w-72 rounded-full bg-emerald-200/70 blur-3xl"},null,-1)),e[13]||(e[13]=t("div",{class:"pointer-events-none absolute -right-24 -top-24 h-80 w-80 rounded-full bg-amber-200/70 blur-3xl"},null,-1)),w(be,{success:Q.value,error:Y.value},null,8,["success","error"]),t("div",fe,[w(pe,{"app-name":u.appName,"is-authenticated":!!s.$page.props.auth?.user,"login-label":s.$page.props.auth?.user?.login},null,8,["app-name","is-authenticated","login-label"]),t("main",_e,[t("div",ge,[w(ce,{items:u.breadcrumbs},null,8,["items"]),t("div",ye,[t("div",he,[t("h1",we,l(u.event?.title||"Событие"),1),t("p",ke,l(u.event?.type?.label||"Тип не задан"),1)]),t("div",Ne,[u.canDelete?(o(),n("button",{key:0,class:"rounded-full border border-rose-300 bg-rose-50 px-4 py-2 text-sm font-semibold text-rose-700 transition hover:-translate-y-0.5 hover:border-rose-400",type:"button",onClick:ee}," Удалить событие ")):d("",!0),u.canBook&&!U.value&&!u.bookingDeadlinePassed?(o(),n("button",{key:1,class:"rounded-full border border-emerald-600 bg-emerald-600 px-4 py-2 text-sm font-semibold text-white transition hover:-translate-y-0.5 hover:bg-emerald-700",type:"button",onClick:X}," Забронировать площадку ")):d("",!0)])]),t("div",$e,[e[5]||(e[5]=t("span",{class:"text-xs uppercase tracking-[0.15em] text-slate-500"},"Время",-1)),t("div",Se,l(F(u.event?.starts_at,u.event?.ends_at)),1)]),t("div",De,[U.value?(o(),n("span",Te," Есть подтвержденное бронирование ")):d("",!0),J.value?(o(),n("span",Me," Есть отмененные бронирования ")):d("",!0)]),t("section",Be,[e[11]||(e[11]=t("div",{class:"flex items-center justify-between gap-3"},[t("h2",{class:"text-lg font-semibold text-slate-900"},"Бронирования")],-1)),G.value?(o(),n("div",je,[(o(!0),n(j,null,A(u.bookings,a=>(o(),n("div",{key:a.id,class:"rounded-2xl border border-slate-200 bg-white px-4 py-3"},[t("div",Le,[t("div",null,[t("p",Ve,l(a.venue?.name||"Площадка"),1),t("p",Ie,l(K(a.status)),1)]),t("div",Ee,l(F(a.starts_at,a.ends_at)),1)]),a.moderation_comment?(o(),n("div",Ue,[e[6]||(e[6]=t("span",{class:"text-xs uppercase tracking-[0.15em] text-slate-500"},"Комментарий",-1)),t("p",Re,l(a.moderation_comment),1)])):d("",!0),a.payment_order?(o(),n("div",Fe,[e[7]||(e[7]=t("span",{class:"text-xs uppercase tracking-[0.15em] text-slate-500"},"Порядок оплаты",-1)),t("p",ze,l(a.payment_order),1)])):d("",!0),a.payment_code?(o(),n("div",Pe,[e[8]||(e[8]=t("span",{class:"text-xs uppercase tracking-[0.15em] text-slate-500"},"Платеж №",-1)),t("p",qe,l(a.payment_code),1)])):d("",!0),R(a)?(o(),n("div",Oe,[e[9]||(e[9]=t("span",{class:"text-xs uppercase tracking-[0.15em] text-slate-500"},"К оплате",-1)),t("p",Ae,l(W(R(a))),1)])):d("",!0),a.status==="awaiting_payment"?(o(),n("div",He,[e[10]||(e[10]=t("span",{class:"text-xs uppercase tracking-[0.15em] text-slate-500"},"Оплатить до",-1)),t("p",Qe,l(a.payment_due_at?le(a.payment_due_at):"Бессрочно"),1)])):d("",!0)]))),128))])):(o(),n("div",Ce," Бронирования пока не созданы. "))])])]),w(xe,{"app-name":u.appName},null,8,["app-name"])])]),S.value?(o(),n("div",Ye,[t("div",Ge,[t("form",{class:L({loading:i(r).processing}),onSubmit:H(Z,["prevent"])},[t("div",{class:"popup-header flex items-center justify-between border-b border-slate-200/80 px-6 py-4"},[e[14]||(e[14]=t("h2",{class:"text-lg font-semibold text-slate-900"},"Новое бронирование",-1)),t("button",{class:"rounded-full border border-slate-200 px-2.5 py-1 text-sm text-slate-500 transition hover:border-slate-300 hover:text-slate-700",type:"button","aria-label":"Закрыть",onClick:M}," x ")]),t("div",Je,[t("div",Ke,[t("div",We,[t("label",Xe,[e[15]||(e[15]=k(" Площадка ",-1)),N(t("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>_.value=a),class:L(["input-predictive rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm text-slate-700",{"is-loading":g.value}]),type:"text",placeholder:"Начните вводить название, метро или адрес",onInput:e[1]||(e[1]=a=>ae(a.target.value))},null,34),[[$,_.value]])]),f.value?(o(),n("div",Ze,l(f.value),1)):!g.value&&x.value.length?(o(),n("div",et,[(o(!0),n(j,null,A(x.value,(a,m)=>(o(),n("button",{key:`${a.id}-${m}`,class:"block w-full border-b border-slate-100 px-3 py-2 text-left last:border-b-0 hover:bg-slate-50",type:"button",onClick:q=>ne(a)},l(a.label),9,tt))),128))])):d("",!0),i(r).venue_id?(o(),n("div",st,[e[16]||(e[16]=t("span",null,"Площадка выбрана.",-1)),t("button",{class:"text-xs font-semibold text-slate-600 transition hover:text-slate-900",type:"button",onClick:oe}," Очистить ")])):d("",!0),i(r).errors.venue_id?(o(),n("div",at,l(i(r).errors.venue_id),1)):d("",!0)]),t("label",rt,[e[17]||(e[17]=k(" Дата ",-1)),N(t("input",{"onUpdate:modelValue":e[2]||(e[2]=a=>i(r).date=a),class:"rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm text-slate-700",type:"date"},null,512),[[$,i(r).date]])]),t("p",nt," Допустимое время до начала: "+l(p.value.leadMinutes)+" мин. ",1),t("div",ot,[t("label",lt,[e[18]||(e[18]=k(" Начало ",-1)),N(t("input",{"onUpdate:modelValue":e[3]||(e[3]=a=>i(r).starts_time=a),class:"rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm text-slate-700",type:"time"},null,512),[[$,i(r).starts_time]])]),t("label",it,[e[19]||(e[19]=k(" Окончание ",-1)),N(t("input",{"onUpdate:modelValue":e[4]||(e[4]=a=>i(r).ends_time=a),class:"rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm text-slate-700",type:"time"},null,512),[[$,i(r).ends_time]])])]),t("p",dt," Минимальная длительность: "+l(p.value.minIntervalMinutes)+" мин. ",1),i(r).errors.starts_at||i(r).errors.ends_at?(o(),n("div",ut,l(i(r).errors.starts_at||i(r).errors.ends_at),1)):C.value?(o(),n("div",mt,l(C.value),1)):d("",!0)])]),t("div",ct,[t("button",{class:"rounded-full border border-slate-200 px-4 py-2 text-sm text-slate-600 transition hover:-translate-y-0.5 hover:border-slate-300",type:"button",disabled:i(r).processing,onClick:M}," Закрыть ",8,pt),t("button",{class:"rounded-full border border-emerald-600 bg-emerald-600 px-4 py-2 text-sm font-semibold text-white transition hover:-translate-y-0.5 hover:bg-emerald-700 disabled:cursor-not-allowed disabled:border-slate-300 disabled:bg-slate-200 disabled:text-slate-500 disabled:hover:translate-y-0",type:"submit",disabled:se.value}," Создать ",8,xt)])],34)])])):d("",!0),D.value?(o(),n("div",bt,[t("div",vt,[t("form",{class:L({loading:i(h).processing}),onSubmit:H(te,["prevent"])},[t("div",{class:"popup-header flex items-center justify-between border-b border-slate-200/80 px-6 py-4"},[e[20]||(e[20]=t("h2",{class:"text-lg font-semibold text-slate-900"},"Удалить событие",-1)),t("button",{class:"rounded-full border border-slate-200 px-2.5 py-1 text-sm text-slate-500 transition hover:border-slate-300 hover:text-slate-700",type:"button","aria-label":"Закрыть",onClick:B}," x ")]),t("div",ft,[t("p",_t," Вы уверены, что хотите удалить событие «"+l(u.event?.title||"Событие")+"»? ",1)]),t("div",gt,[t("button",{class:"rounded-full border border-slate-200 px-4 py-2 text-sm text-slate-600 transition hover:-translate-y-0.5 hover:border-slate-300",type:"button",disabled:i(h).processing,onClick:B}," Закрыть ",8,yt),t("button",{class:"rounded-full border border-rose-500 bg-rose-500 px-4 py-2 text-sm font-semibold text-white transition hover:-translate-y-0.5 hover:bg-rose-600 disabled:cursor-not-allowed disabled:border-slate-300 disabled:bg-slate-200 disabled:text-slate-500 disabled:hover:translate-y-0",type:"submit",disabled:i(h).processing}," Удалить ",8,ht)])],34)])])):d("",!0)],64))}};export{St as default};
