import{c as O,u as X,r as y,a as k,w as Y,b as r,d as e,f as j,e as p,n as q,g as z,j as w,k as U,h as l,v as Z,F as L,i as M,l as g,m as h,t as i,A as ee,o as a,z as te}from"./app-BG8bJDk_.js";import{_ as se}from"./Breadcrumbs-BJkTr2TQ.js";import{_ as oe,a as le}from"./MainHeader-CSzL04-A.js";import{_ as ae}from"./MainSidebar-Gh5823Zl.js";import{_ as re}from"./SystemNoticeStack-D6BD3byq.js";const ne={class:"relative min-h-screen overflow-hidden bg-[#f7f1e6] text-slate-900"},de={class:"relative mx-auto flex max-w-[1360px] flex-col gap-8 px-6 py-8"},ie={class:"rounded-3xl border border-slate-200/80 bg-white/90 p-6 shadow-sm page-content-wrapper"},ue={class:"mt-6 flex flex-wrap items-center gap-3 rounded-2xl border border-slate-200 bg-white px-4 py-4"},pe={class:"mt-6 overflow-hidden rounded-2xl border border-slate-200 bg-white"},be={class:"w-full text-left text-sm"},xe={class:"px-4 py-3 text-slate-600"},ce={class:"px-4 py-3 font-semibold text-slate-800"},me={class:"px-4 py-3 text-slate-700"},fe={class:"px-4 py-3 text-slate-700"},ve={class:"px-4 py-3"},ye={class:"flex flex-col gap-1"},ge={key:0,class:"text-xs text-rose-700"},he={class:"px-4 py-3"},ke={class:"flex flex-wrap justify-end gap-2"},we=["onClick"],_e=["onClick"],Ce=["onClick"],Se=["onClick"],$e={key:0},je={key:0,class:"mt-4 flex flex-wrap items-center gap-2 text-sm"},Ue={class:"w-full max-w-md rounded-3xl border border-slate-200 bg-white shadow-xl"},Fe={class:"px-6 py-4"},Ne={class:"text-sm text-slate-600"},Be={class:"font-semibold text-slate-900"},Ve={class:"mt-4 flex flex-col gap-2 text-xs uppercase tracking-[0.15em] text-slate-500"},qe={key:0,class:"mt-2 text-xs text-rose-700"},De={class:"w-full max-w-md rounded-3xl border border-slate-200 bg-white shadow-xl"},Te={class:"px-6 py-4"},Ee={class:"text-sm text-slate-600"},Oe={class:"font-semibold text-slate-900"},ze={class:"mt-4 flex flex-col gap-2 text-xs uppercase tracking-[0.15em] text-slate-500"},Le={key:0,class:"mt-2 text-xs text-rose-700"},Me={class:"w-full max-w-md rounded-3xl border border-slate-200 bg-white shadow-xl"},He={class:"px-6 py-4"},Ae={class:"text-sm text-slate-600"},Ie={class:"font-semibold text-slate-900"},Re={class:"mt-4 flex flex-col gap-2 text-xs uppercase tracking-[0.15em] text-slate-500"},Pe={key:0,class:"mt-2 text-xs text-rose-700"},Xe={__name:"Balances",props:{appName:{type:String,default:"Laravel"},navigation:{type:Object,default:()=>({title:"Разделы",data:[]})},activeHref:{type:String,default:""},breadcrumbs:{type:Array,default:()=>[]},users:{type:Object,default:()=>({data:[],links:[]})},filters:{type:Object,default:()=>({q:"",status:""})}},setup(u){const F=u,D=O(()=>F.navigation?.data??[]),T=O(()=>(D.value?.length??0)>0),c=X(),b=y(""),n=y(""),x=k({q:F.filters?.q??"",status:F.filters?.status??""}),H=()=>{ee.get("/admin/balances",{q:x.q,status:x.status},{preserveState:!0,replace:!0})};Y(()=>[x.q,x.status],()=>{H()});const E=(o,t)=>{const s=Number(o??0);return`${(Number.isNaN(s)?0:s).toLocaleString("ru-RU")} ${t||"RUB"}`},A=o=>o==="blocked"?"Заблокирован":"Активен",N=y(!1),B=y(!1),V=y(!1),d=y(null),m=k({amount:""}),f=k({amount:""}),v=k({reason:""}),I=k({}),R=o=>{b.value="",n.value="",d.value=o,m.reset(),N.value=!0},P=o=>{b.value="",n.value="",d.value=o,f.reset(),B.value=!0},G=o=>{b.value="",n.value="",d.value=o,v.reset(),V.value=!0},_=()=>{N.value=!1},C=()=>{B.value=!1},S=()=>{V.value=!1},J=()=>{d.value&&m.post(`/admin/balances/${d.value.id}/top-up`,{preserveScroll:!0,onSuccess:()=>{b.value="Баланс пополнен.",_()},onError:o=>{n.value=o.amount||"Не удалось пополнить баланс."},onFinish:()=>{c.props?.errors?.amount&&(n.value=c.props.errors.amount)}})},K=()=>{d.value&&f.post(`/admin/balances/${d.value.id}/debit`,{preserveScroll:!0,onSuccess:()=>{b.value="Списание выполнено.",C()},onError:o=>{n.value=o.amount||"Не удалось списать средства."},onFinish:()=>{c.props?.errors?.amount&&(n.value=c.props.errors.amount)}})},Q=()=>{d.value&&v.post(`/admin/balances/${d.value.id}/block`,{preserveScroll:!0,onSuccess:()=>{b.value="Баланс заблокирован.",S()},onError:o=>{n.value=o.reason||"Не удалось заблокировать баланс."},onFinish:()=>{c.props?.errors?.reason&&(n.value=c.props.errors.reason)}})},W=o=>{b.value="",n.value="",I.post(`/admin/balances/${o.id}/unblock`,{preserveScroll:!0,onSuccess:()=>{b.value="Баланс разблокирован."},onError:()=>{n.value="Не удалось разблокировать баланс."}})};return(o,t)=>(a(),r("div",ne,[t[21]||(t[21]=e("div",{class:"pointer-events-none absolute -left-28 top-12 h-72 w-72 rounded-full bg-emerald-200/70 blur-3xl"},null,-1)),t[22]||(t[22]=e("div",{class:"pointer-events-none absolute -right-24 -top-24 h-80 w-80 rounded-full bg-amber-200/70 blur-3xl"},null,-1)),j(re,{success:b.value,error:n.value},null,8,["success","error"]),e("div",de,[j(oe,{"app-name":u.appName,"is-authenticated":!!o.$page.props.auth?.user,"login-label":o.$page.props.auth?.user?.login},null,8,["app-name","is-authenticated","login-label"]),e("main",{class:q(["grid gap-6",{"lg:grid-cols-[240px_1fr]":T.value}])},[T.value?(a(),z(ae,{key:0,title:u.navigation.title,data:D.value,"active-href":u.activeHref},null,8,["title","data","active-href"])):p("",!0),e("div",ie,[j(se,{items:u.breadcrumbs},null,8,["items"]),t[8]||(t[8]=e("h1",{class:"text-3xl font-semibold text-slate-900"},"Балансы пользователей",-1)),e("div",ue,[w(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>l(x).q=s),class:"w-full rounded-2xl border border-slate-200 px-4 py-2 text-sm text-slate-700 md:w-64",type:"text",placeholder:"Поиск по логину или ID"},null,512),[[U,l(x).q]]),w(e("select",{"onUpdate:modelValue":t[1]||(t[1]=s=>l(x).status=s),class:"rounded-2xl border border-slate-200 px-4 py-2 text-sm text-slate-700"},[...t[5]||(t[5]=[e("option",{value:""},"Все статусы",-1),e("option",{value:"active"},"Активные",-1),e("option",{value:"blocked"},"Заблокированные",-1)])],512),[[Z,l(x).status]])]),e("div",pe,[e("table",be,[t[7]||(t[7]=e("thead",{class:"bg-slate-50 text-xs uppercase tracking-[0.15em] text-slate-500"},[e("tr",null,[e("th",{class:"px-4 py-3"},"ID"),e("th",{class:"px-4 py-3"},"Пользователь"),e("th",{class:"px-4 py-3"},"Доступно"),e("th",{class:"px-4 py-3"},"В удержании"),e("th",{class:"px-4 py-3"},"Статус"),e("th",{class:"px-4 py-3 text-right"},"Действия")])],-1)),e("tbody",null,[(a(!0),r(L,null,M(u.users.data,s=>(a(),r("tr",{key:s.id,class:"border-t border-slate-100"},[e("td",xe,i(s.id),1),e("td",ce,i(s.login),1),e("td",me,i(E(s.balance.available_amount,s.balance.currency)),1),e("td",fe,i(E(s.balance.held_amount,s.balance.currency)),1),e("td",ve,[e("div",ye,[e("span",{class:q(["inline-flex w-fit items-center rounded-full border px-3 py-1 text-xs font-semibold",s.balance.status==="blocked"?"border-rose-200 bg-rose-50 text-rose-700":"border-emerald-200 bg-emerald-50 text-emerald-700"])},i(A(s.balance.status)),3),s.balance.block_reason?(a(),r("span",ge,i(s.balance.block_reason),1)):p("",!0)])]),e("td",he,[e("div",ke,[e("button",{class:"rounded-full border border-emerald-200 bg-emerald-50 px-3 py-1 text-xs font-semibold text-emerald-700 transition hover:-translate-y-0.5 hover:border-emerald-300",type:"button",onClick:$=>R(s)}," Пополнить ",8,we),e("button",{class:"rounded-full border border-amber-200 bg-amber-50 px-3 py-1 text-xs font-semibold text-amber-700 transition hover:-translate-y-0.5 hover:border-amber-300",type:"button",onClick:$=>P(s)}," Списать ",8,_e),s.balance.status!=="blocked"?(a(),r("button",{key:0,class:"rounded-full border border-rose-200 bg-rose-50 px-3 py-1 text-xs font-semibold text-rose-700 transition hover:-translate-y-0.5 hover:border-rose-300",type:"button",onClick:$=>G(s)}," Блокировать ",8,Ce)):(a(),r("button",{key:1,class:"rounded-full border border-slate-200 bg-slate-50 px-3 py-1 text-xs font-semibold text-slate-700 transition hover:-translate-y-0.5 hover:border-slate-300",type:"button",onClick:$=>W(s)}," Разблокировать ",8,Se))])])]))),128)),u.users.data.length?p("",!0):(a(),r("tr",$e,[...t[6]||(t[6]=[e("td",{class:"px-4 py-6 text-center text-sm text-slate-500",colspan:"6"}," Пользователи не найдены. ",-1)])]))])])]),u.users.links?.length?(a(),r("div",je,[(a(!0),r(L,null,M(u.users.links,s=>(a(),z(l(te),{key:s.label,class:q(["rounded-full border border-slate-200 px-3 py-1 text-slate-600 transition hover:-translate-y-0.5 hover:border-slate-300",{"bg-slate-900 text-white":s.active,"pointer-events-none opacity-50":!s.url}]),href:s.url||"",innerHTML:s.label},null,8,["class","href","innerHTML"]))),128))])):p("",!0)])],2),j(le,{"app-name":u.appName},null,8,["app-name"])]),N.value?(a(),r("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-slate-900/40 px-4",onClick:g(_,["self"])},[e("div",Ue,[e("form",{class:"popup-body pt-4",onSubmit:g(J,["prevent"])},[e("div",{class:"popup-header flex items-center justify-between border-b border-slate-200/80 px-6 py-4"},[t[9]||(t[9]=e("h2",{class:"text-lg font-semibold text-slate-900"},"Пополнение баланса",-1)),e("button",{class:"rounded-full border border-slate-200 px-2.5 py-1 text-sm text-slate-500",type:"button",onClick:_}," x ")]),e("div",Fe,[e("p",Ne,[t[10]||(t[10]=h(" Пользователь: ",-1)),e("span",Be,i(d.value?.login),1)]),e("label",Ve,[t[11]||(t[11]=h(" Сумма ",-1)),w(e("input",{"onUpdate:modelValue":t[2]||(t[2]=s=>l(m).amount=s),type:"number",min:"1",class:"rounded-2xl border border-slate-200 px-4 py-3 text-sm text-slate-800 outline-none transition focus:border-slate-400"},null,512),[[U,l(m).amount]])]),l(m).errors.amount?(a(),r("div",qe,i(l(m).errors.amount),1)):p("",!0)]),e("div",{class:"popup-footer flex flex-wrap justify-end gap-3 border-t border-slate-200/80 px-6 py-4"},[e("button",{class:"rounded-full border border-slate-200 px-4 py-2 text-sm text-slate-600",type:"button",onClick:_}," Закрыть "),t[12]||(t[12]=e("button",{class:"rounded-full border border-emerald-600 bg-emerald-600 px-4 py-2 text-sm font-semibold text-white",type:"submit"}," Пополнить ",-1))])],32)])])):p("",!0),B.value?(a(),r("div",{key:1,class:"fixed inset-0 z-50 flex items-center justify-center bg-slate-900/40 px-4",onClick:g(C,["self"])},[e("div",De,[e("form",{class:"popup-body pt-4",onSubmit:g(K,["prevent"])},[e("div",{class:"popup-header flex items-center justify-between border-b border-slate-200/80 px-6 py-4"},[t[13]||(t[13]=e("h2",{class:"text-lg font-semibold text-slate-900"},"Списание средств",-1)),e("button",{class:"rounded-full border border-slate-200 px-2.5 py-1 text-sm text-slate-500",type:"button",onClick:C}," x ")]),e("div",Te,[e("p",Ee,[t[14]||(t[14]=h(" Пользователь: ",-1)),e("span",Oe,i(d.value?.login),1)]),e("label",ze,[t[15]||(t[15]=h(" Сумма ",-1)),w(e("input",{"onUpdate:modelValue":t[3]||(t[3]=s=>l(f).amount=s),type:"number",min:"1",class:"rounded-2xl border border-slate-200 px-4 py-3 text-sm text-slate-800 outline-none transition focus:border-slate-400"},null,512),[[U,l(f).amount]])]),l(f).errors.amount?(a(),r("div",Le,i(l(f).errors.amount),1)):p("",!0)]),e("div",{class:"popup-footer flex flex-wrap justify-end gap-3 border-t border-slate-200/80 px-6 py-4"},[e("button",{class:"rounded-full border border-slate-200 px-4 py-2 text-sm text-slate-600",type:"button",onClick:C}," Закрыть "),t[16]||(t[16]=e("button",{class:"rounded-full border border-amber-500 bg-amber-500 px-4 py-2 text-sm font-semibold text-white",type:"submit"}," Списать ",-1))])],32)])])):p("",!0),V.value?(a(),r("div",{key:2,class:"fixed inset-0 z-50 flex items-center justify-center bg-slate-900/40 px-4",onClick:g(S,["self"])},[e("div",Me,[e("form",{class:"popup-body pt-4",onSubmit:g(Q,["prevent"])},[e("div",{class:"popup-header flex items-center justify-between border-b border-slate-200/80 px-6 py-4"},[t[17]||(t[17]=e("h2",{class:"text-lg font-semibold text-slate-900"},"Блокировка баланса",-1)),e("button",{class:"rounded-full border border-slate-200 px-2.5 py-1 text-sm text-slate-500",type:"button",onClick:S}," x ")]),e("div",He,[e("p",Ae,[t[18]||(t[18]=h(" Пользователь: ",-1)),e("span",Ie,i(d.value?.login),1)]),e("label",Re,[t[19]||(t[19]=h(" Причина блокировки ",-1)),w(e("textarea",{"onUpdate:modelValue":t[4]||(t[4]=s=>l(v).reason=s),rows:"4",class:"rounded-2xl border border-slate-200 px-4 py-3 text-sm text-slate-800 outline-none transition focus:border-slate-400"},null,512),[[U,l(v).reason]])]),l(v).errors.reason?(a(),r("div",Pe,i(l(v).errors.reason),1)):p("",!0)]),e("div",{class:"popup-footer flex flex-wrap justify-end gap-3 border-t border-slate-200/80 px-6 py-4"},[e("button",{class:"rounded-full border border-slate-200 px-4 py-2 text-sm text-slate-600",type:"button",onClick:S}," Закрыть "),t[20]||(t[20]=e("button",{class:"rounded-full border border-rose-600 bg-rose-600 px-4 py-2 text-sm font-semibold text-white",type:"submit"}," Заблокировать ",-1))])],32)])])):p("",!0)]))}};export{Xe as default};
