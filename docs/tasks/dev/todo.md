# Тип задачи: Архитектура (arch)

001. [x] Начальная структура доменных сущностей пользователей
014. [x] Имплементировать план из 013 задачи
015. [x] Переименовать упоминание/референс сущности "место" - Place/Places в Venue/Venues по всему проекту

017. [x] Спроектировать систему логирования для сущностей
018. [x] Имплементировать систему логирования по плану задачи 017
046. [x] Архитектура контрактов (Contract/ContractType) и связка прав через контракт
051. [x] Проектирование сущности VenueSchedule для расписаний площадок
086. [x] Убедиться, что есть механизм/воркер (фоновый), который проводит актуализацию контрактов, согласно датам окончания срока действия контракта (если установлено)
087. [x] Добавить логирование по контрактам
093. [x] Если у площадки существует активный контракт типа "Владелец", у которого были назначено право "Редактирование прав контрактов" - это значит что он может редактировать права всех контракты, включая права контракта типа "создатель", но исключая контракт типа "супервайзер"
---

# Тип задачи: Верстка (layout)

002. [x] Главная страница: базовая структура
008. [x] Отображение залов в главном меню
009. [x] Площадки: фильтры, сортировка, группировка, пагинация
047. [x] Заменить обертку контента на main (section -> main)
049. [x] Унифицировать попапы: heading, scrollable content, footer с кнопками
088. [x] На странице /admin/contracts-moderation в таблице необходимо добавить первой колонку "Сущность" (например "Площадка"), а колонку, которая сейчас называется "Площадка" переименовать в "Название" - это нужно потому что в проекте контракты могут быть с разными сущностями - а не только с площадкой
089. [x] На странице /admin/contracts-moderation при клике на название сейчас открывается попап с подробностями - туда необходимо добавить список прав - как это сделано в аналогичном попапе на странице /admin/users-moderation при клике на пользователя - открывается попап с правами, которые можно редактировать.

---

# Тип задачи: Функционал (feature)

003. [x] Авторизация: popup форма и обновление header
004. [x] Страница account: вкладки и выход
005. [x] Демо-данные: роли, пользователи, профили (seeders/factories)
006. [x] Доменная сущность Venue
007. [x] Обновить доменные сущности Users по новым правилам
012. [x] Динамический блок навигации в контексте раздела
016. [x] Создать процесс регистрации пользователя. При котором пользователь обязан: указать логин (уникальный, латинские символы и цифры, знак подчеркивания), пароль (min 6 символов, не простой), email (стандартная валидация). Опционально: роль участника процесса. Добавить кнопку регистрации, в попап авторизации, которая будет переводить на страницу регистрации. По успешной регистрации - необходимо авторизовать пользователя и отправлять на страницу аккаунта.
021. [x] Страница account: вкладки по ролям участника
022. [x] Страница account: кнопка подтверждения email
026. [x] Страница account: вкладка "Контакты" и управление email
028. [x] Подтверждение контактов через код и AJAX UX
029. [x] Страница account: заменить вкладки на боковое внутреннее меню
030. [x] Площадки: отдельные страницы для каждого типа
031. [x] Площадки: вынести навигацию и список в VenueCatalogService
039. [x] Admin: раздел "Логи" и список сущностей для просмотра
040. [x] Адреса: доменная сущность Address и связь с площадками
041. [x] Метро: доменная сущность Metro и сидер станций (2025)
042. [x] Адреса: предиктивный ввод через Yandex API и интеграционный слой
048. [x] Breadcrumbs: добавить компонент для внутренних страниц (Presentation слой)
052. [x] Интерфейс расписания: раздел в sidebar и страница расписания зала
054. [x] UI событий и бронирований: список, создание, связь с площадкой
055. [x] Удаление событий: UI и проверка прав (создатель/админ)
056. [x] Единый флоу: создание события + бронь площадки (если указана)
057. [x] Sidebar площадки: раздел "Бронирование" для пользователей с правами подтверждения/отмены
058. [x] Логирование событий и бронирований
059. [x] Площадки: раздел "Настройки" в sidebar и страница с доступом по праву редактирования площадки + admin
060. [x] Применить настройки площадки (lead time, min interval) в логике бронирований вместо хардкода
061. [x] Вынести временные параметры события (lead time, min duration) в дефолтные настройки
062. [x] Площадки: учесть настройки бронирований в UI (lead time и min interval)
063. [x] События: UI для дефолтных настроек времени (lead time, min duration)
064. [x] Бронирования: использовать порядок оплаты в UI и процессе подтверждения
065. [x] Логирование настроек площадки (VenueSettings) в админских логах — с корректным добавлением в интерфейсе
066. [x] Настройки площадки: стоимость аренды (длительность и цена)
067. [x] Payments: универсальная доменная сущность Payment
068. [x] Баланс пользователя: пополнение, холд, списание, блокировка
069. [x] Настройки площадки: booking_mode (instant/approval_required)
070. [ ] Страница оплаты по payment_code и варианты оплаты
071. [ ] UX: обработка протухшего CSRF
072. [x] Бронирования: срок ожидания оплаты и авто-статус по истечении
073. [x] Уведомления и сообщения: типы, диалоги, настройки отправителей, счетчики
074. [x] Бронирования: системные уведомления со статусами и комментариями
075. [x] Адреса: определение метро по вводимому адресу площадки (Yandex)
076. [x] Площадки: публичная страница "О площадке" с секциями и якорями
077. [x] UI: фиксация шапки, sidebar и корректная высота блока sidebar
078. [x] Уведомления и сообщения: перейти с polling на WebSocket
079. [x] Бронирования: обновление статусов и уведомления через scheduler/job
080. [ ] Сообщения: поиск в диалогах и группировка системных
081. [x] Бронирования: логика оплаты и подтверждения (processes.md)
082. [x] Бронирования: автоотмена pending по времени старта (протестировать)
083. [ ] Проверка: автоотмена pending (задача 082)
085. [x] При подтверждении заявки на контракт с площадкой типа "Владелец" или "Супервайзер" из соответствующего раздела модерации (/admin/contracts-moderation) необходимо в подтверждающий попап добавить возможность задать период действия контракта (от и до), со значением "от" по умолчанию - сегодня.
090. [x] Добавить возможность блокировать ("аннулировать") контракт, в интерфейсе /admin/contracts-moderation в таблице, добавив колонку "действия", по аналогии с тем, как это сделано на странице модерации пользователей /admin/users-moderation - по нажатию кнопки также возникает подтверждающий попап с возможностью указания причины блокировки.
091. [x] Убедиться, что пользователь не может редактировать (в том числе аннулировать) свой контракт
092. [x] На странице /venues/halls/na-dubninskoi/contracts есть секция "Запросы на контракты", в которой пользователи могут подать заявку на контракт типа "Владелец" или "Супервайзер" согласно определенным условиям. Данная секция не должна показываться не должна показываться если эти обе роли уже заняты - то есть если у площадки уже существуют активные контракты с типами "Владелец" и "Супервайзер". Если существует один активный контракт одного типа, например "Владелец" или "Супервайзер" то не показывать в секции плажку того контракта который уже существует а показывать только ту, активного контракта на тип которой еще нет.
097. [x] Разрешить редактировать название площадки при статусе площадки "подтвержден" - с учетом наличия права у пользователя в контракте на редактирование площадки.
098. [x] Разработать централизованную возможность отправлять сообщения на различные контакты. сейчас предлагаю реализовать только отправку на почту, далее и остальные типы контактов подключим. сделать проверку - в процесс "подтверждение пользователем указанного контакта" (пока только email)
099. [x] У модератора должен быть не полный доступ к /admin разделу - а только к страницам группы "модерация" - актуализировать sidebar. также проверить остальные системные роли: editor etc.
100. [x] Страница системных ошибок (500, 404, 403 и тд) сбрасывает некоторые установки.
101. [x] В /account (группа "Настройки") добавить раздел настроек уведомлений: список типов уведомлений, которые отправляются в проекте (например "Смена статуса бронирования", "Смена статуса пользователя" и другие — проверить по проекту), с общим переключателем и чекбоксами внешних каналов ("Также отправлять на:"). Каналы: email, telegram, vk и др. типы контактов; по умолчанию выключены. Если контакт есть — показывать значение, если подтвержден — разрешать включать чекбокс. Включенный канал означает дублирование внутреннего уведомления во внешний канал.
102. [x] Добавить в /admin/logs кнопки: скачать текущий дамп (по нажатию открывается выбор JSON/MySQL), удалить логи (confirm: "Вы уверены что хотите удалить логи?"), скачать и удалить (confirm: "Подтвердите действие \"скачать и удалить\"").
103. [ ] SMTP: для prod перейти на TLS/SSL (587/465) с валидным сертификатом и корректным SMTP‑хостом; порт 25 без шифрования оставить только для dev (обновить настройки и проверить доставку).
104. [x] Бронирования: в попапе просмотра заявки в поле «Стоимость» по умолчанию показывать стоимость из самого бронирования (не из текущих настроек площадки). Если стоимость бронирования отличается от настройки площадки — добавить «(!)» к label и title «стоимость аренды площадки такая‑то».
095. [x] Разработать страницу "супервайзера" — добавить обработку комиссии (с учетом процессов модерации и роли супервайзера).
096. [ ] Разработать флоу для работы с событиями: возможность добавления комиссии организатором события, формирования текущей стоимости согласно забронированной площадке и тд. Возможно необходимо ограничить событие только одним подтвержденным бронированием.
105. [x] Участники событий и резерв: модель, UI, статусы
106. [x] Правила ролей и лимита участников по типам событий

---


# Тип задачи: Проектирование

011. [ ] Решение по правилам хранения task-веток
013. [x] Решить как встроить в концепцию приложения роли (но не те роли, которые имеют отношение к администрированию сайта, такие как: admin, moderator, editor), а роли как участники процесса: игрок, тренер, судья, администратор площадки, медиа / блогер, продавец, персонал, другое)
019. [x] User: добавить registered_via (enum) и registration_details
020. [x] Спланировать сущности ролей участников и регистрацию через сервис
023. [x] Убрать из модели User поля name, так как оно будет браться из UserProfile и email, так как email будут храниться в модели UserEmail - и соответственно прокинуть данные изменения в процесс регистрации пользователя и в отображение карточке профиля на странице "аккаунт" на вкладке пользователь, оставив там только login, пароль, id, дату регистрации, статус пользователя (подтвержден/не подтвержден), а если пользователь подтвержден то указать дату когда был подтвержден. И обновить все связанные процессы - миграции, сидеры, фабрики etc.
024. [x] Добавить сущность UserEmail в соотношении User - UserEmail 1-to-many: в данной модели должно помимо стандартных атрибутов должна присутствовать информация о подтверждении - когда подтвержден (выполнено в рамках задачи 023)
025. [x] Решить ситуацию с регистрацией - если email обязательное поле, как быть с теми кто зарегистрируется через мессенджеры - там же email уже можно оставить (выполнено в рамках задачи 023)
027. [x] Миграция UserEmail -> UserContact с enum type и обновлением документации
032. [x] Admin: раздел с доступами по level и динамическим меню (модерация пользователей)
033. [x] Sidebar: поддержка группированных ссылок (с заголовками групп и подпунктами) для внутренних разделов, например Admin
034. [x] Admin: модерация площадок
035. [x] Площадки: процесс создания и UX формы добавления
036. [x] Аккаунт: редактирование данных пользователя и профиля
037. [x] Единый источник обязательных полей модерации пользователя
038. [x] Площадки: редактирование и единые требования модерации
043. [ ] Пересмотреть размещение настроек адресов (не в integrations.php)
044. [x] Централизованный слой UI-рендера (меню, формы, HTML-элементы)
045. [x] Архитектура прав доступа (permissions)
050. [x] Централизованные проверки confirmed + role_level
053. [x] Проектирование домена Events (Event, EventType, Tournament) и флоу бронирований
084. [x] Контракты площадки: новые типы (создатель/владелец/супервайзер/сотрудник) и модерация
094. [x] Разнести в sidebar раздел "расписание" на два пункта - один - текущий нужно перенести в группу "администрация" и показывать его только тем пользователям у которых есть контракт с правом "Управление расписанием площадки" и соответственно сделать проверку на сервере - чтобы если у пользователя данного права нет - 403 при заходе по URL, а второй пункт sidebar (страница) - это публичное расписание - в котором показывается только секция расписание (календарь, визуально который выглядит как на административной странице расписания - то есть показывается текущий месяц (наверху кнопки "пред", "след" для переключения по месяцам), дни в календаре также имеют цветные буллеты занятости или статуса (закрыто и тд), снизу календаря легенда - пояснение цветов булетов и тд. в общем календарь точь-в-точь как на административной странице "расписание", а вот при клике на день возникает уже попап бронирования - точь-в-точь такой же как при клике на день календаря на странице "о площадке"
