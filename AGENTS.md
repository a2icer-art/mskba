# AGENTS.md
Инструкция для AI-агента проекта
(Laravel + Inertia + Vue)

---

## Absolute rules (обязательные правила)

- Все файлы проекта **обязательно** сохраняются в кодировке **UTF-8 без BOM**.
- Код, комментарии, строки, шаблоны и JSON/YAML-файлы **должны корректно поддерживать кириллицу**.
- Запрещено использовать кодировки Windows-1251, ISO-8859-* и любые другие, кроме UTF-8.
- При работе со строками:
  - не выполнять ручных перекодировок;
  - не использовать устаревшие функции, нарушающие UTF-8.
- Все изменения должны быть **минимальными и локальными**.
- Не выполнять рефакторинг или архитектурные изменения без явного запроса.
- **Никогда** не коммитить секреты, ключи, пароли, токены и доступы.
- При любых сомнениях — следовать существующим паттернам и структуре проекта.

---

## Language rules (язык общения и разработки)

- **AI-агент обязан отвечать в чате на русском языке**, если пользователь не указал иное явно.
- Комментарии в коде, документация и markdown-файлы:
  - по умолчанию пишутся **на русском языке**;
  - допускается английский язык для:
    - общепринятых технических терминов;
    - публичных API / SDK;
    - случаев, где проект уже использует английский.
- Названия классов, методов, переменных — **только на английском** (Laravel / PHP conventions).

---

## Repo structure (conventions)

- _PROJECT — корень проекта

### Документация
- _DOCS — _PROJECT/docs
- _DTASKS — _DOCS/tasks
- _DPROJECT — _DOCS/project

Назначение:
- `_DPROJECT` — описание проекта, архитектура, договорённости, принципы
- `_DTASKS` — задачи, исследования, реализация, история решений по веткам

### Приватные конфиги
- _CONFIGS — _PROJECT/myconfigs
  - хранит приватные данные (FTP / SSH / env / интеграции)
  - **НЕ коммитится**
  - **НЕ деплоится**
  - использовать файлы:
    - _CONFIGS/ftp.md
    - _CONFIGS/ssh.md
    - _CONFIGS/env.md

---

## Stack

- Backend: Laravel
- Frontend: Inertia.js + Vue

---

## PHP autoloading and namespaces (PSR-4)

- PSR-4 обязателен без исключений.
- Namespace **строго** соответствует пути файла.
- Стандартные Laravel mappings:
  - App\ → app/
  - Database\Seeders\ → database/seeders/
  - Database\Factories\ → database/factories/
  - Tests\ → tests/
- Имя файла = имя класса.
- Один основной класс на файл (если не оговорено иное).
- Новые корневые namespace:
  - только при необходимости;
  - только с явным PSR-4 mapping в composer.json;
  - учитывать необходимость `composer dump-autoload`.

---

## Code style

### PHP
- PSR-12
- Laravel conventions
- Laravel Pint (preset: laravel), если присутствует в проекте

### Vue / JavaScript
- Следовать ESLint / Prettier конфигурации проекта
- Composition API
- `<script setup>`, если используется в проекте
- Именование:
  - Components — PascalCase
  - Composables — useXxx
  - Stores — useXxxStore

---

## Inertia.js conventions

- Сервер возвращает:
  - `Inertia::render('Path/To/Page', props)`
- Страницы:
  - `resources/js/Pages/**`
- Компоненты:
  - `resources/js/Components/**`
- Layouts:
  - `resources/js/Layouts/**`

(Если в проекте используются другие пути — следовать фактической структуре.)

---

## Laravel architecture rules

- `routes/web.php` — Inertia-страницы и web-endpoints
- `routes/api.php` — API
- Валидация:
  - предпочтительно `FormRequest`
- Контроллеры:
  - должны быть тонкими;
  - бизнес-логика выносится в Service / Action классы
- Работа с БД:
  - Eloquent ORM;
  - eager loading;
  - избегать N+1;
  - выбирать только необходимые поля.

---

## Architecture: DDD (Domain-driven modules)

В проекте используется DDD-подход в виде **доменных модулей**, размещённых в папке `app/Domain`.

### Зачем используется папка Domain
- `Domain` является **явной границей бизнес-логики**.
- Вся логика предметной области должна находиться внутри `app/Domain`, а не быть размазанной по `Http`, `Services`, `Helpers` и т.п.
- Папка `Domain` логически отделяет:
  - бизнес-правила проекта;
  - от технических слоёв Laravel (HTTP, консоль, провайдеры, инфраструктура).

### Общая структура
- `app/Domain/<DomainName>/`

Примеры доменов:
- `app/Domain/Orders`
- `app/Domain/Billing`
- `app/Domain/Users`

### Рекомендуемая структура домена
Внутри каждого доменного модуля могут использоваться следующие подпапки (по необходимости):

- `Models/` — доменные модели / агрегаты
- `Builders/` — кастомные Eloquent Query Builders
- `Services/` — переиспользуемая доменная логика
- `UseCases/` — бизнес-сценарии (точка входа в домен)
- `Resources/` — представление доменных данных
- `Events/` — доменные события
- `Enums/` — доменные перечисления
- `ValueObjects/` — объекты-значения
- `DTO/` — объекты передачи данных
- `Policies/` — доменные политики доступа
- `Contracts/` — интерфейсы домена
- `Infrastructure/` — технические реализации и интеграции

Структура не является строго обязательной, но **должна быть единообразной по проекту**.

### Namespaces (PSR-4)
- Namespace доменных классов должен соответствовать PSR-4:
  - `App\Domain\<DomainName>\...` → `app/Domain/<DomainName>/...`
- Имя файла всегда совпадает с именем класса.

### Правила и ограничения
- Контроллеры (`app/Http/Controllers`) должны быть **тонкими** и только:
  - принимать запрос;
  - вызывать доменные UseCases / Services;
  - возвращать ответ.
- Доменные классы:
  - **не должны зависеть** от HTTP-слоя (Request, Controller, Response);
  - не должны использовать Facades без крайней необходимости.
- Новая бизнес-логика:
  - добавляется **в существующий домен**, если он логически подходит;
  - новый домен создаётся только при явной необходимости.
- Не создавать домены и namespace «по одной таблице» без причины.
  Домены соответствуют **бизнес-областям**, а не каждой сущности БД.

### Запрещённые практики
- Размещение бизнес-логики в:
  - `Controllers`
  - `Http/Requests`
  - глобальных `Helpers`
- Создание абстрактных `Services` вне доменного контекста.

---

## Work modes (commands)

Режим указывается в начале запроса пользователя.

### Основные режимы
- `#plan` — анализ, архитектура, предложения (без изменения кода)
- `#execute` — реализация, изменение кода
- `#fix` — локальное исправление бага
- `#refactor` — рефакторинг без изменения поведения (только по явному запросу)
- `#docs` — работа только с документацией
- `#frontend` — только Vue / Inertia
- `#backend` — только Laravel

### Task-based режим
- `#execute_task` — режим выполнения задачи

#### Поведение в режиме #execute_task
- Считается, что работа ведётся в рамках конкретной git-ветки.
- Необходимо:
  1. В `_DTASKS` создать папку с именем **текущей ветки**:
     `_DOCS/tasks/<branch-name>/`
  2. Использовать эту папку для:
     - описания задачи;
     - фиксации решений;
     - промежуточных заметок;
     - итогов реализации.

> Подробный сценарий работы в режиме `#execute_task`
> будет описан и расширен позднее.

### Модификаторы
- `#no-commit` — не предлагать и не писать commit message
- `#no-doc` — не обновлять документацию

Пример комбинации:
`#execute_task:[no-doc, backend]`

---

## Output expectations

- Кратко указывать:
  - что изменено;
  - где;
  - зачем.
- Перечислять добавленные файлы.
- Если требуются ручные действия:
  - artisan-команды;
  - миграции;
  - сборка фронта;
  — указывать шаги явно.

---

## Priority

- AGENTS.md имеет приоритет над любыми неявными предположениями AI-агента.
- При конфликте инструкций — всегда следовать AGENTS.md.
